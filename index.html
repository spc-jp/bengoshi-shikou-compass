<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼è­·å£« æ€è€ƒã‚³ãƒ³ãƒ‘ã‚¹ï¼ˆãƒ†ã‚¹ãƒˆç‰ˆï¼‰</title>
    <style>
        :root {
            --primary-color: #0f4c81; /* ä¿¡é ¼æ„Ÿã®ã‚ã‚‹ãƒã‚¤ãƒ“ãƒ¼ */
            --accent-color: #d9534f; /* æ³¨æ„å–šèµ·ã®èµ¤ */
            --bg-color: #f4f7f9;
            --card-bg: #ffffff;
            --text-color: #333;
            --input-bg: #ffffff;
            --input-border: #ccc;
            --border-radius: 8px;
            --shadow: 0 2px 4px rgba(0,0,0,0.05);
            --modal-overlay: rgba(0,0,0,0.5);
        }

        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç”¨å¤‰æ•° */
        body.dark-mode {
            --primary-color: #64b5f6; /* æ˜ã‚‹ã‚ã®ãƒ–ãƒ«ãƒ¼ */
            --accent-color: #ff8a80;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --input-bg: #2c2c2c;
            --input-border: #555;
            --shadow: 0 2px 8px rgba(0,0,0,0.5);
            --modal-overlay: rgba(255,255,255,0.1);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Utility */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            min-height: calc(100vh - 100px); /* ãƒ•ãƒƒã‚¿ãƒ¼åˆ†ã‚’ç¢ºä¿ */
        }
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--input-border); /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œã®ãŸã‚å¤‰æ•°åŒ– */
            transition: background-color 0.3s, border-color 0.3s;
        }
        h2 {
            font-size: 1.1rem;
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--primary-color);
            border-bottom: 2px solid #eee;
            padding-bottom: 8px;
        }
        body.dark-mode h2 {
            border-bottom-color: #444;
        }
        h3 {
            font-size: 0.95rem;
            margin: 15px 0 5px 0;
            color: #555;
        }
        body.dark-mode h3 {
            color: #aaa;
        }
        input[type="text"], input[type="date"], input[type="number"], select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            font-size: 0.95rem;
            margin-bottom: 5px;
            background-color: var(--input-bg);
            color: var(--text-color);
        }
        textarea {
            resize: vertical;
            min-height: 200px;
            font-family: inherit;
        }
        label {
            display: block;
            font-size: 0.85rem;
            font-weight: bold;
            color: #666;
            margin-bottom: 3px;
        }
        body.dark-mode label {
            color: #aaa;
        }

        /* Header Area */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .header-left h1 {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin: 0;
        }
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--text-color);
            padding: 5px;
            border-radius: 50%;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }
        .icon-btn:hover {
            background-color: rgba(0,0,0,0.05);
        }
        body.dark-mode .icon-btn:hover {
            background-color: rgba(255,255,255,0.1);
        }
        .btn-text {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--primary-color);
            text-decoration: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Section 1: Case Header */
        .case-header-grid {
            display: grid;
            gap: 15px;
        }
        .row-1, .row-2 {
            display: grid;
            gap: 15px;
        }
        .row-1 { grid-template-columns: 2fr 1fr 1fr 1fr; }
        .row-2 { grid-template-columns: 1fr 1fr 1fr; }

        .conflict-check-group select {
            font-weight: bold;
        }
        .status-ok { color: green; }
        .status-warn { color: var(--accent-color); background-color: #fff0f0; }
        body.dark-mode .status-warn { background-color: #330000; }

        /* Section 2: 3 Columns */
        .main-columns {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }
        .col {
            display: flex;
            flex-direction: column;
        }
        .fee-section {
            background-color: #fcfcfc;
            border-top: 2px dashed #ddd;
            padding-top: 10px;
            margin-top: 15px;
        }
        body.dark-mode .fee-section {
            background-color: #252525;
            border-top-color: #555;
        }
        .fee-row {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .fee-row label {
            width: 80px;
            margin-bottom: 0;
            font-size: 0.8rem;
        }
        .fee-row input {
            flex: 1;
            text-align: right;
        }
        .fee-unit {
            margin-left: 5px;
            font-size: 0.8rem;
            color: #666;
        }
        body.dark-mode .fee-unit {
            color: #aaa;
        }

        /* Section 3: ToDo */
        .todo-input-area {
            display: flex;
            gap: 10px;
            align-items: flex-end;
            margin-bottom: 15px;
        }
        .todo-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .todo-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
            gap: 10px;
        }
        body.dark-mode .todo-item { border-bottom-color: #444; }
        .todo-item:last-child { border-bottom: none; }
        .priority-high { color: var(--accent-color); font-weight: bold; font-size: 0.8rem; border: 1px solid var(--accent-color); padding: 1px 4px; border-radius: 3px; }
        .priority-mid { color: #e67e22; font-size: 0.8rem; border: 1px solid #e67e22; padding: 1px 4px; border-radius: 3px; }
        .priority-low { color: #27ae60; font-size: 0.8rem; border: 1px solid #27ae60; padding: 1px 4px; border-radius: 3px; }
        
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: opacity 0.2s;
        }
        .btn:hover { opacity: 0.9; }
        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }
        .btn-outline:hover { background-color: rgba(15, 76, 129, 0.1); }
        body.dark-mode .btn-outline:hover { background-color: rgba(100, 181, 246, 0.1); }
        .btn-sm { padding: 6px 12px; font-size: 0.85rem; }

        /* Section 4: Output Buttons */
        .output-area {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
            margin-bottom: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        body.dark-mode .output-area { border-top-color: #555; }
        .output-btn-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .output-desc {
            font-size: 0.75rem;
            color: #666;
        }
        body.dark-mode .output-desc { color: #aaa; }

        /* Utility Footer (Demo/Clear) */
        .utility-footer {
            text-align: center;
            margin-bottom: 40px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        .btn-text-sub {
            background: none;
            border: none;
            color: #999;
            font-size: 0.8rem;
            cursor: pointer;
            text-decoration: underline;
        }
        .btn-text-sub:hover { color: var(--primary-color); }

        /* Copyright Footer */
        .main-footer {
            text-align: center;
            padding: 20px;
            color: #999;
            font-size: 0.8rem;
            border-top: 1px solid #eee;
        }
        body.dark-mode .main-footer { border-top-color: #333; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--modal-overlay);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal {
            background: var(--card-bg);
            padding: 20px;
            width: 80%;
            max-width: 800px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            color: var(--text-color);
            box-shadow: var(--shadow);
            border: 1px solid var(--input-border);
        }
        .modal-sm {
            max-width: 500px;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        body.dark-mode .modal-header { border-bottom-color: #444; }
        .modal-body {
            overflow-y: auto;
            padding-bottom: 10px;
        }
        .modal-body textarea {
            height: 300px;
            font-family: monospace;
        }
        
        /* Settings Modal Specific */
        .settings-row {
            margin-bottom: 15px;
        }
        .theme-options {
            display: flex;
            gap: 15px;
        }
        .theme-option {
            border: 1px solid var(--input-border);
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }
        .theme-option.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* Usage Modal Specific */
        .usage-list {
            padding-left: 20px;
        }
        .usage-list li {
            margin-bottom: 8px;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .row-1 { grid-template-columns: 1fr 1fr; }
            .row-2 { grid-template-columns: 1fr; }
            .main-columns { grid-template-columns: 1fr; }
            .todo-input-area { flex-direction: column; align-items: stretch; }
            .output-area { flex-direction: column; align-items: center; }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- Header -->
    <header>
        <div class="header-left">
            <h1>å¼è­·å£« æ€è€ƒã‚³ãƒ³ãƒ‘ã‚¹<span style="font-size:0.6em; margin-left:10px; color:#666;">ï¼ˆãƒ†ã‚¹ãƒˆç‰ˆï¼‰</span></h1>
        </div>
        <div class="header-right">
            <button class="btn-text" onclick="openModal('usageModal')">
                <span>ğŸ“–</span> ä½¿ã„æ–¹
            </button>
            <button class="icon-btn" onclick="openModal('settingsModal')" title="è¨­å®š">
                âš™ï¸
            </button>
        </div>
    </header>

    <!-- 1. Case Header Block -->
    <section class="card" id="case-header">
        <div class="case-header-grid">
            <div class="row-1">
                <div>
                    <label>æ¡ˆä»¶å</label>
                    <input type="text" id="caseName" placeholder="ä¾‹ï¼šã€‡ã€‡æ° å»ºç‰©æ˜æ¸¡è«‹æ±‚äº‹ä»¶">
                </div>
                <div>
                    <label>ä¾é ¼è€…å</label>
                    <input type="text" id="clientName" placeholder="å±±ç”° å¤ªéƒ">
                </div>
                <div>
                    <label>ç›¸æ‰‹æ–¹</label>
                    <input type="text" id="opponentName" placeholder="éˆ´æœ¨ æ¬¡éƒ">
                </div>
                <div>
                    <label>åˆ†é‡</label>
                    <select id="field">
                        <option value="å‚µæ¨©å›å">å‚µæ¨©å›å</option>
                        <option value="é›¢å©š">é›¢å©š</option>
                        <option value="ç›¸ç¶š">ç›¸ç¶š</option>
                        <option value="åŠ´åƒ">åŠ´åƒ</option>
                        <option value="ä¸å‹•ç”£">ä¸å‹•ç”£</option>
                        <option value="äº¤é€šäº‹æ•…">äº¤é€šäº‹æ•…</option>
                        <option value="ä¼æ¥­æ³•å‹™">ä¼æ¥­æ³•å‹™</option>
                        <option value="åˆ‘äº‹">åˆ‘äº‹</option>
                        <option value="ãã®ä»–">ãã®ä»–</option>
                    </select>
                </div>
            </div>
            <div class="row-2">
                <div>
                    <label>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                    <select id="status">
                        <option value="ç›¸è«‡ä¸­">ç›¸è«‡ä¸­</option>
                        <option value="å—ä»»">å—ä»»</option>
                        <option value="äº¤æ¸‰ä¸­">äº¤æ¸‰ä¸­</option>
                        <option value="èª¿åœ">èª¿åœ</option>
                        <option value="è¨´è¨Ÿ">è¨´è¨Ÿ</option>
                    </select>
                </div>
                <div>
                    <label>æœ€é‡è¦æœŸé™</label>
                    <input type="date" id="deadline">
                </div>
                <div class="conflict-check-group">
                    <label>åˆ©ç›Šç›¸åãƒã‚§ãƒƒã‚¯</label>
                    <select id="conflictCheck" onchange="updateConflictColor(this)">
                        <option value="æœªç¢ºèª">æœªç¢ºèª</option>
                        <option value="OK" class="status-ok">OKï¼ˆå•é¡Œãªã—ï¼‰</option>
                        <option value="è¦æ³¨æ„" class="status-warn">è¦æ³¨æ„ï¼è¦ç¢ºèª</option>
                    </select>
                </div>
            </div>
        </div>
    </section>

    <!-- 2. Main 3 Columns -->
    <div class="main-columns">
        <!-- Left Column -->
        <div class="col card">
            <h2>ç›¸è«‡ãƒ»äº‹å®Ÿé–¢ä¿‚</h2>
            <textarea id="facts" placeholder="ãƒ»æ™‚ç³»åˆ—&#10;ãƒ»ç›¸è«‡è€…ãŒä¸»å¼µã™ã‚‹äº‹å®Ÿ&#10;ãƒ»è¨¼æ‹ ã®æœ‰ç„¡"></textarea>
        </div>

        <!-- Center Column -->
        <div class="col card">
            <h2>è«–ç‚¹ãƒ»åˆ¤ä¾‹ãƒ¡ãƒ¢</h2>
            <textarea id="issues" placeholder="ãƒ»æ³•çš„æ§‹æˆ&#10;ãƒ»äº‰ç‚¹ã¨ãªã‚Šãã†ãªäº‹å®Ÿ&#10;ãƒ»ãƒªã‚µãƒ¼ãƒãŒå¿…è¦ãªåˆ¤ä¾‹"></textarea>
        </div>

        <!-- Right Column -->
        <div class="col card">
            <h2>æ–¹é‡ãƒ»ãƒªã‚¹ã‚¯æ•´ç†</h2>
            <textarea id="strategy" style="min-height: 150px;" placeholder="ãƒ»è§£æ±ºã®ã‚´ãƒ¼ãƒ«è¨­å®š&#10;ãƒ»äº¤æ¸‰/è¨´è¨Ÿã®é¸æŠ&#10;ãƒ»æ•—è¨´ãƒªã‚¹ã‚¯"></textarea>

            <!-- Fee Section -->
            <div class="fee-section">
                <h3>è²»ç”¨ç›®å®‰ãƒ¬ãƒ³ã‚¸ï¼ˆç¨è¾¼ï¼‰</h3>
                <div class="fee-row">
                    <label>å†…å®¹è¨¼æ˜</label>
                    <input type="text" id="feeContentCert" placeholder="ä¾‹ï¼š3.3ã€œ5.5">
                    <span class="fee-unit">ä¸‡å††</span>
                </div>
                <div class="fee-row">
                    <label>äº¤æ¸‰</label>
                    <input type="text" id="feeNeg" placeholder="ä¾‹ï¼š11ã€œ22">
                    <span class="fee-unit">ä¸‡å††</span>
                </div>
                <div class="fee-row">
                    <label>èª¿åœ</label>
                    <input type="text" id="feeMediation" placeholder="">
                    <span class="fee-unit">ä¸‡å††</span>
                </div>
                <div class="fee-row">
                    <label>è¨´è¨Ÿ</label>
                    <input type="text" id="feeLitigation" placeholder="ä¾‹ï¼š33ã€œ">
                    <span class="fee-unit">ä¸‡å††</span>
                </div>
                <label style="margin-top:5px;">å‚™è€ƒï¼ˆæ—¥å½“ãƒ»å®Ÿè²»ç­‰ï¼‰</label>
                <textarea id="feeRemarks" style="min-height: 60px;" placeholder="å®Ÿè²»åˆ¥ã€æ—¥å½“3.3ä¸‡/å› ãªã©"></textarea>
            </div>
        </div>
    </div>

    <!-- 3. ToDo Section -->
    <section class="card" id="todo-section">
        <h2>ToDoï¼æœŸé™ç®¡ç†</h2>
        <div style="margin-bottom: 10px; text-align: right;">
            <button class="btn btn-outline btn-sm" onclick="insertTemplateTodo()">ç›¸è«‡å†…å®¹ã‹ã‚‰ToDoé››å½¢ã‚’æŒ¿å…¥</button>
        </div>
        
        <div class="todo-input-area">
            <div style="flex: 2;">
                <label>ToDoå†…å®¹</label>
                <input type="text" id="newTodoText" placeholder="æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›">
            </div>
            <div style="flex: 1;">
                <label>æœŸé™</label>
                <input type="date" id="newTodoDate">
            </div>
            <div style="width: 100px;">
                <label>å„ªå…ˆåº¦</label>
                <select id="newTodoPriority">
                    <option value="é«˜">é«˜</option>
                    <option value="ä¸­" selected>ä¸­</option>
                    <option value="ä½">ä½</option>
                </select>
            </div>
            <button class="btn" onclick="addTodo()">è¿½åŠ </button>
        </div>

        <ul id="todoList" class="todo-list">
            <!-- JS populates this -->
        </ul>
    </section>

    <!-- 4. Output Buttons -->
    <footer class="output-area">
        <div class="output-btn-group">
            <button class="btn" style="background-color: #555;" onclick="generateOutput('internal')">â‘  äº‹å‹™æ‰€å†…å…±æœ‰ç”¨ å‡ºåŠ›</button>
            <span class="output-desc">è©³ç´°ãƒ»ãƒ¡ãƒ¢å«ã‚€å…¨æ–‡</span>
        </div>
        <div class="output-btn-group">
            <button class="btn" style="background-color: var(--primary-color);" onclick="generateOutput('client')">â‘¡ ä¾é ¼è€…èª¬æ˜ç”¨ å‡ºåŠ›</button>
            <span class="output-desc">æ–¹é‡ãƒ»è²»ç”¨ã‚’ä¸­å¿ƒã«æ•´ç†</span>
        </div>
        <div class="output-btn-group">
            <button class="btn" style="background-color: #27ae60;" onclick="generateOutput('estimate')">â‘¢ è¦‹ç©ãŸãŸãç”¨ å‡ºåŠ›</button>
            <span class="output-desc">æ¦‚ç®—è²»ç”¨ã®ã¿æŠ½å‡º</span>
        </div>
    </footer>

    <!-- Utility Links (Demo/Clear) -->
    <div class="utility-footer">
        <button class="btn-text-sub" onclick="fillDemoData()">ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›</button>
        <button class="btn-text-sub" onclick="clearData()">å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢</button>
    </div>

</div>

<!-- Footer -->
<footer class="main-footer">
    ãƒ†ã‚¹ãƒˆç‰ˆï¼ˆãƒ™ãƒ¼ã‚¿ç‰ˆï¼‰ Â© 2026 SPC
</footer>

<!-- Modals -->

<!-- Settings Modal -->
<div class="modal-overlay" id="settingsModal">
    <div class="modal modal-sm">
        <div class="modal-header">
            <h3>è¨­å®š</h3>
            <button class="btn btn-sm btn-outline" onclick="closeModal('settingsModal')">Ã—</button>
        </div>
        <div class="modal-body">
            <div class="settings-row">
                <label>ç”»é¢ãƒ†ãƒ¼ãƒ</label>
                <div class="theme-options">
                    <div class="theme-option active" id="themeLight" onclick="setTheme('light')">ãƒ©ã‚¤ãƒˆ</div>
                    <div class="theme-option" id="themeDark" onclick="setTheme('dark')">ãƒ€ãƒ¼ã‚¯</div>
                </div>
            </div>
            <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
            <div class="settings-row">
                <label>å¼è­·å£«åŸºæœ¬æƒ…å ±ï¼ˆå‡ºåŠ›æ™‚ã«ä½¿ç”¨ï¼‰</label>
                <div style="margin-bottom:10px;">
                    <label>äº‹å‹™æ‰€å</label>
                    <input type="text" id="lawyerOffice" placeholder="ä¾‹ï¼šæ±äº¬ä¸­å¤®æ³•å¾‹äº‹å‹™æ‰€">
                </div>
                <div>
                    <label>å¼è­·å£«å</label>
                    <input type="text" id="lawyerName" placeholder="ä¾‹ï¼šå¼è­·å£« æ³•å‹™ å¤ªéƒ">
                </div>
            </div>
        </div>
        <div style="margin-top: 15px; text-align: right;">
            <button class="btn" onclick="closeModal('settingsModal')">é–‰ã˜ã‚‹</button>
        </div>
    </div>
</div>

<!-- Usage Modal -->
<div class="modal-overlay" id="usageModal">
    <div class="modal modal-sm">
        <div class="modal-header">
            <h3>ä½¿ã„æ–¹ãƒ»ç›®çš„</h3>
            <button class="btn btn-sm btn-outline" onclick="closeModal('usageModal')">Ã—</button>
        </div>
        <div class="modal-body">
            <h4>ã€ç›®çš„ã€‘</h4>
            <p>ç›¸è«‡å¯¾å¿œæ™‚ã®æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ï¼ˆäº‹å®Ÿæ•´ç†â†’è«–ç‚¹æŠ½å‡ºâ†’æ–¹é‡ç­–å®šâ†’è²»ç”¨æç¤ºï¼‰ã‚’1ç”»é¢ã§å®Œçµã•ã›ã€ã‚¹ãƒ ãƒ¼ã‚ºãªæ¥­å‹™é‚è¡Œã¨ã€äº‹å‹™å±€ã¸ã®æŒ‡ç¤ºå‡ºã—ãƒ»ä¾é ¼è€…ã¸ã®å›ç­”ä½œæˆã‚’åŠ¹ç‡åŒ–ã—ã¾ã™ã€‚</p>
            
            <h4>ã€ä½¿ã„æ–¹ã€‘</h4>
            <ul class="usage-list">
                <li><strong>ãƒ˜ãƒƒãƒ€ãƒ¼å…¥åŠ›ï¼š</strong> æ¡ˆä»¶ã®åŸºæœ¬æƒ…å ±ã¨ã€åˆ©ç›Šç›¸åãƒ»æœŸé™ãªã©ã®ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªæƒ…å ±ã‚’å…¥åŠ›ã—ã¾ã™ã€‚</li>
                <li><strong>3ã‚«ãƒ©ãƒ æ•´ç†ï¼š</strong> 
                    <ul>
                        <li>å·¦ï¼šç›¸è«‡è€…ã‹ã‚‰èãå–ã£ãŸäº‹å®Ÿ</li>
                        <li>ä¸­ï¼šæ³•çš„è«–ç‚¹ã‚„ãƒªã‚µãƒ¼ãƒãƒ¡ãƒ¢</li>
                        <li>å³ï¼šè§£æ±ºæ–¹é‡ã¨ã€æ¦‚ç®—ã®è²»ç”¨æ„Ÿ</li>
                    </ul>
                </li>
                <li><strong>ToDoä½œæˆï¼š</strong> å¿…è¦ãªã‚¿ã‚¹ã‚¯ã‚’ç™»éŒ²ã€‚ã€Œé››å½¢æŒ¿å…¥ã€ã§åˆå‹•ã‚¿ã‚¹ã‚¯ã‚’ä¸€æ‹¬ç™»éŒ²ã§ãã¾ã™ã€‚</li>
                <li><strong>å‡ºåŠ›ï¼š</strong> ç”¨é€”ï¼ˆæ‰€å†…ãƒ»ä¾é ¼è€…ãƒ»è¦‹ç©ï¼‰ã«åˆã‚ã›ã¦ãƒ†ã‚­ã‚¹ãƒˆã‚’è‡ªå‹•ç”Ÿæˆã—ã€ãƒ¡ãƒ¼ãƒ«ã‚„ãƒãƒ£ãƒƒãƒˆãªã©ã«ãƒšãƒ¼ã‚¹ãƒˆã§ãã¾ã™ã€‚</li>
            </ul>
        </div>
        <div style="margin-top: 15px; text-align: right;">
            <button class="btn" onclick="closeModal('usageModal')">é–‰ã˜ã‚‹</button>
        </div>
    </div>
</div>

<!-- Output Modal -->
<div class="modal-overlay" id="outputModal">
    <div class="modal">
        <div class="modal-header">
            <h3 id="modalTitle">å‡ºåŠ›çµæœ</h3>
            <button class="btn btn-sm btn-outline" onclick="closeModal('outputModal')">é–‰ã˜ã‚‹</button>
        </div>
        <div class="modal-body">
            <textarea id="outputText"></textarea>
        </div>
        <div style="margin-top: 10px; text-align: right;">
            <button class="btn" onclick="copyToClipboard()">ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼</button>
        </div>
    </div>
</div>

<script>
    // --- Modal Logic ---
    function openModal(id) {
        document.getElementById(id).style.display = 'flex';
    }
    function closeModal(id) {
        document.getElementById(id).style.display = 'none';
    }

    // --- Theme Logic ---
    function setTheme(mode) {
        const body = document.body;
        const lightBtn = document.getElementById('themeLight');
        const darkBtn = document.getElementById('themeDark');

        if (mode === 'dark') {
            body.classList.add('dark-mode');
            darkBtn.classList.add('active');
            lightBtn.classList.remove('active');
        } else {
            body.classList.remove('dark-mode');
            lightBtn.classList.add('active');
            darkBtn.classList.remove('active');
        }
    }

    // --- Conflict Check Color Logic ---
    function updateConflictColor(select) {
        select.className = '';
        if (select.value === 'OK') select.classList.add('status-ok');
        if (select.value === 'è¦æ³¨æ„') select.classList.add('status-warn');
    }

    // --- ToDo Logic ---
    const todoListElement = document.getElementById('todoList');

    function addTodoItem(text, date, priority) {
        const li = document.createElement('li');
        li.className = 'todo-item';
        
        let priorityClass = 'priority-mid';
        if(priority === 'é«˜') priorityClass = 'priority-high';
        if(priority === 'ä½') priorityClass = 'priority-low';

        li.innerHTML = `
            <input type="checkbox">
            <span class="${priorityClass}">${priority}</span>
            <div style="flex:1">
                <div>${text}</div>
                <div style="font-size:0.8rem; color:var(--text-color); opacity:0.7;">æœŸé™: ${date || 'æœªå®š'}</div>
            </div>
            <button class="btn btn-outline btn-sm" onclick="this.parentElement.remove()" style="padding:2px 6px;">Ã—</button>
        `;
        todoListElement.appendChild(li);
    }

    function addTodo() {
        const text = document.getElementById('newTodoText').value;
        const date = document.getElementById('newTodoDate').value;
        const priority = document.getElementById('newTodoPriority').value;

        if(!text) return;

        addTodoItem(text, date, priority);
        document.getElementById('newTodoText').value = '';
    }

    function insertTemplateTodo() {
        const templates = [
            { text: 'å¥‘ç´„æ›¸ãƒ»é–¢é€£è¦ç´„ã®æœ‰ç„¡ç¢ºèª', priority: 'é«˜' },
            { text: 'è«‹æ±‚æ›¸ï¼å…¥é‡‘å±¥æ­´ã®ç¢ºèª', priority: 'é«˜' },
            { text: 'ç£ä¿ƒå±¥æ­´ãƒ»äº¤æ¸‰çµŒéã®æ•´ç†', priority: 'ä¸­' },
            { text: 'æ™‚åŠ¹å®Œæˆã®æœ‰ç„¡ãƒã‚§ãƒƒã‚¯', priority: 'é«˜' },
            { text: 'ç›¸æ‰‹æ–¹è³‡ç”£èª¿æŸ»ï¼ˆç™»è¨˜ç­‰ï¼‰', priority: 'ä¸­' },
            { text: 'è¨¼æ‹ è³‡æ–™ã®åé›†ãƒ»ä¿å…¨', priority: 'é«˜' }
        ];

        // Set deadline to 1 week later by default for templates
        const today = new Date();
        today.setDate(today.getDate() + 7);
        const dateStr = today.toISOString().split('T')[0];

        templates.forEach(item => {
            addTodoItem(item.text, dateStr, item.priority);
        });
    }

    // --- Demo & Clear Logic ---
    function fillDemoData() {
        document.getElementById('caseName').value = 'éˆ´æœ¨ä¸€éƒ è²¸é‡‘è¿”é‚„è«‹æ±‚äº‹ä»¶';
        document.getElementById('clientName').value = 'éˆ´æœ¨ ä¸€éƒ';
        document.getElementById('opponentName').value = 'ä½è—¤ æ¬¡éƒ';
        document.getElementById('field').value = 'å‚µæ¨©å›å';
        document.getElementById('status').value = 'ç›¸è«‡ä¸­';
        document.getElementById('conflictCheck').value = 'OK';
        updateConflictColor(document.getElementById('conflictCheck'));
        
        // æ—¥ä»˜ã‚’ä»Šæ—¥ã«
        document.getElementById('deadline').value = new Date().toISOString().split('T')[0];

        document.getElementById('facts').value = 
`ãƒ»2023å¹´5æœˆ1æ—¥ã€çŸ¥äººã§ã‚ã‚‹ç›¸æ‰‹æ–¹ã«ç¾é‡‘300ä¸‡å††ã‚’è²¸ã—ä»˜ã‘ãŸã€‚
ãƒ»å€Ÿç”¨æ›¸ã‚ã‚Šï¼ˆç›´ç­†ç½²åãƒ»æŠ¼å°ã‚ã‚Šï¼‰ã€‚
ãƒ»è¿”æ¸ˆæœŸé™ã¯2024å¹´5æœˆæœ«æ—¥ã ã£ãŸãŒã€æœªã è¿”æ¸ˆãŒãªã„ã€‚
ãƒ»é›»è©±ã«ã¯å‡ºã‚‹ãŒã€Œæ¥æœˆæ‰•ã†ã€ã®ä¸€ç‚¹å¼µã‚Šã€‚
ãƒ»ç›¸æ‰‹æ–¹ã¯è‡ªå–¶æ¥­ï¼ˆé£²é£Ÿåº—ï¼‰ã‚’å–¶ã‚“ã§ãŠã‚Šã€åº—ã¯å–¶æ¥­ã—ã¦ã„ã‚‹æ§˜å­ã€‚`;

        document.getElementById('issues').value = 
`ãƒ»æ¶ˆæ»…æ™‚åŠ¹ã®ç¢ºèªï¼ˆå•†äº‹ã‹æ°‘äº‹ã‹ã€æœ€çµ‚å–å¼•æ—¥ã¯ã„ã¤ã‹ï¼‰
ãƒ»ç›¸æ‰‹æ–¹ã®è³‡åŠ›ï¼ˆåº—ã®çµŒå–¶çŠ¶æ…‹ã€ä¸å‹•ç”£æ‰€æœ‰ã®æœ‰ç„¡ï¼‰
ãƒ»å€Ÿç”¨æ›¸ã®è¨¼æ‹ ä¾¡å€¤ï¼ˆçœŸæ­£ãªæˆç«‹ãŒèªã‚ã‚‰ã‚Œã‚‹ã‹ï¼‰
ãƒ»ä»®å·®æŠ¼ãˆã®å¿…è¦æ€§æ¤œè¨`;

        document.getElementById('strategy').value = 
`ã€æ–¹é‡ã€‘
ã¾ãšã¯å†…å®¹è¨¼æ˜éƒµä¾¿ã«ã¦å‚¬å‘Šã€‚
åå¿œãŒãªã‘ã‚Œã°ã€è¨´è¨Ÿæèµ·ãŠã‚ˆã³é é‡‘ç­‰ã®ä»®å·®æŠ¼ãˆã‚’æ¤œè¨ã€‚

ã€ãƒªã‚¹ã‚¯ã€‘
ãƒ»ç›¸æ‰‹æ–¹ãŒç„¡è³‡åŠ›ã§ã‚ã‚‹å¯èƒ½æ€§ï¼ˆå›åä¸èƒ½ãƒªã‚¹ã‚¯ï¼‰
ãƒ»ç ´ç”£ç”³ç«‹ã¦ã®å¯èƒ½æ€§`;

        document.getElementById('feeContentCert').value = '3.3';
        document.getElementById('feeNeg').value = '11';
        document.getElementById('feeLitigation').value = '33';
        document.getElementById('feeRemarks').value = 'æ—¥å½“3.3ä¸‡å††/å›ã€å®Ÿè²»åˆ¥';

        // è¨­å®šæƒ…å ±ã®ãƒ‡ãƒ¢
        document.getElementById('lawyerOffice').value = 'ä¸¸ã®å†…ç·åˆæ³•å¾‹äº‹å‹™æ‰€';
        document.getElementById('lawyerName').value = 'å¼è­·å£« å±±ç”° å¤ªéƒ';

        // ToDoã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰è¿½åŠ 
        todoListElement.innerHTML = '';
        insertTemplateTodo();
    }

    function clearData() {
        if(!confirm('å…¥åŠ›å†…å®¹ã‚’ã™ã¹ã¦æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ')) return;
        
        const inputs = document.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
            if(input.type !== 'button' && input.type !== 'submit') {
                input.value = '';
            }
        });
        // Selectã®åˆæœŸå€¤æˆ»ã—ãªã©å¾®èª¿æ•´
        document.getElementById('status').value = 'ç›¸è«‡ä¸­';
        document.getElementById('conflictCheck').value = 'æœªç¢ºèª';
        updateConflictColor(document.getElementById('conflictCheck'));
        document.getElementById('newTodoPriority').value = 'ä¸­';
        
        todoListElement.innerHTML = '';
    }

    // --- Output Logic ---
    function generateOutput(type) {
        // Gather Data
        const d = {
            caseName: document.getElementById('caseName').value,
            client: document.getElementById('clientName').value,
            opponent: document.getElementById('opponentName').value,
            field: document.getElementById('field').value,
            status: document.getElementById('status').value,
            deadline: document.getElementById('deadline').value,
            conflict: document.getElementById('conflictCheck').value,
            facts: document.getElementById('facts').value,
            issues: document.getElementById('issues').value,
            strategy: document.getElementById('strategy').value,
            fees: {
                content: document.getElementById('feeContentCert').value,
                neg: document.getElementById('feeNeg').value,
                med: document.getElementById('feeMediation').value,
                lit: document.getElementById('feeLitigation').value,
                rem: document.getElementById('feeRemarks').value
            },
            lawyer: {
                office: document.getElementById('lawyerOffice').value,
                name: document.getElementById('lawyerName').value
            },
            todos: []
        };

        // Gather ToDos
        document.querySelectorAll('.todo-item').forEach(item => {
            const text = item.querySelector('div > div').innerText;
            const meta = item.querySelector('div > div:nth-child(2)').innerText;
            const checked = item.querySelector('input[type="checkbox"]').checked ? 'â– ' : 'â–¡';
            d.todos.push(`${checked} ${text} (${meta})`);
        });

        let output = "";
        let lawyerSign = "";
        if(d.lawyer.office || d.lawyer.name) {
            lawyerSign = `\n--------------------------------------------------\n${d.lawyer.office}\n${d.lawyer.name}\n--------------------------------------------------`;
        }

        if (type === 'internal') {
            output = `ã€æ¡ˆä»¶ç®¡ç†ã‚·ãƒ¼ãƒˆï¼š${d.caseName}ã€‘\n`;
            output += `â– åŸºæœ¬æƒ…å ±\n`;
            output += `ãƒ»ä¾é ¼è€…ï¼š${d.client}\nãƒ»ç›¸æ‰‹æ–¹ï¼š${d.opponent}\nãƒ»åˆ†é‡ï¼š${d.field}\nãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼š${d.status}\n`;
            output += `ãƒ»æœŸé™ï¼š${d.deadline}\nãƒ»åˆ©ç›Šç›¸åï¼š${d.conflict}\n\n`;
            output += `â– äº‹å®Ÿé–¢ä¿‚\n${d.facts}\n\n`;
            output += `â– æ³•çš„è«–ç‚¹ãƒ»ãƒ¡ãƒ¢\n${d.issues}\n\n`;
            output += `â– æ–¹é‡ãƒ»ãƒªã‚¹ã‚¯\n${d.strategy}\n\n`;
            output += `â– è²»ç”¨æ„Ÿ\n`;
            if(d.fees.content) output += `ãƒ»å†…å®¹è¨¼æ˜ï¼š${d.fees.content}ä¸‡å††\n`;
            if(d.fees.neg) output += `ãƒ»äº¤æ¸‰ï¼š${d.fees.neg}ä¸‡å††\n`;
            if(d.fees.med) output += `ãƒ»èª¿åœï¼š${d.fees.med}ä¸‡å††\n`;
            if(d.fees.lit) output += `ãƒ»è¨´è¨Ÿï¼š${d.fees.lit}ä¸‡å††\n`;
            output += `ãƒ»å‚™è€ƒï¼š${d.fees.rem}\n\n`;
            output += `â– Next Action\n${d.todos.join('\n')}`;
        } 
        else if (type === 'client') {
            output = `ã€ç›¸è«‡ãƒ¡ãƒ¢ã€‘${d.caseName}\n`;
            output += `${d.client} æ§˜\n\n`;
            output += `æœ¬æ—¥ã¯ã”ç›¸è«‡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚\nã”ç›¸è«‡å†…å®¹ã¨ä»Šå¾Œã®æ–¹å‘æ€§ã«ã¤ã„ã¦ã¾ã¨ã‚ã¾ã—ãŸã®ã§ã€ã”ç¢ºèªãã ã•ã„ã€‚\n\n`;
            output += `â– ã”ç›¸è«‡ã®æ¦‚è¦\n${d.facts}\n\n`;
            output += `â– ä»Šå¾Œã®å¯¾å¿œæ–¹é‡\n${d.strategy}\n\n`;
            output += `â– è²»ç”¨ç›®å®‰ï¼ˆç¨åˆ¥ãƒ»å®Ÿè²»åˆ¥ï¼‰\n`;
            if(d.fees.content) output += `ãƒ»å†…å®¹è¨¼æ˜ä½œæˆï¼š${d.fees.content}ä¸‡å††ç¨‹åº¦\n`;
            if(d.fees.neg) output += `ãƒ»äº¤æ¸‰ç€æ‰‹é‡‘ï¼š${d.fees.neg}ä¸‡å††ç¨‹åº¦\n`;
            if(d.fees.med) output += `ãƒ»èª¿åœç€æ‰‹é‡‘ï¼š${d.fees.med}ä¸‡å††ç¨‹åº¦\n`;
            if(d.fees.lit) output += `ãƒ»è¨´è¨Ÿç€æ‰‹é‡‘ï¼š${d.fees.lit}ä¸‡å††ç¨‹åº¦\n`;
            output += `â€»å…·ä½“çš„ãªãŠè¦‹ç©ã‚Šã¯åˆ¥é€”ä½œæˆã„ãŸã—ã¾ã™ã€‚\n\n`;
            output += `â– ãŠé¡˜ã„ã—ãŸã„äº‹é …\n${d.todos.join('\n')}`;
            output += lawyerSign;
        }
        else if (type === 'estimate') {
            output = `ã€å¾¡è¦‹ç©å‚è€ƒã€‘${d.caseName}\n\n`;
            output += `â– å¼è­·å£«è²»ç”¨ï¼ˆç€æ‰‹é‡‘ç›®å®‰ï¼‰\n`;
            output += `----------------------------\n`;
            if(d.fees.content) output += `å†…å®¹è¨¼æ˜éƒµä¾¿ä½œæˆï¼š\né‡‘ ${d.fees.content}ä¸‡å††ï¼ˆç¨è¾¼ï¼‰\n\n`;
            if(d.fees.neg) output += `ç¤ºè«‡äº¤æ¸‰å¯¾å¿œï¼š\né‡‘ ${d.fees.neg}ä¸‡å††ï¼ˆç¨è¾¼ï¼‰\n\n`;
            if(d.fees.med) output += `èª¿åœå¯¾å¿œï¼š\né‡‘ ${d.fees.med}ä¸‡å††ï¼ˆç¨è¾¼ï¼‰\n\n`;
            if(d.fees.lit) output += `è¨´è¨Ÿå¯¾å¿œï¼š\né‡‘ ${d.fees.lit}ä¸‡å††ï¼ˆç¨è¾¼ï¼‰\n\n`;
            output += `----------------------------\n`;
            output += `â– ãã®ä»–å‚™è€ƒ\n${d.fees.rem || 'ãƒ»æ—¥å½“ã€å®Ÿè²»ï¼ˆå°ç´™ä»£ã€éƒµåˆ¸ä»£ï¼‰ã¯åˆ¥é€”ç™ºç”Ÿã„ãŸã—ã¾ã™ã€‚'}\n`;
            output += `ãƒ»æˆåŠŸå ±é…¬ã«ã¤ã„ã¦ã¯åˆ¥é€”å”è­°ã¨ãªã‚Šã¾ã™ã€‚`;
            output += lawyerSign;
        }

        document.getElementById('modalTitle').innerText = 
            type === 'internal' ? 'äº‹å‹™æ‰€å†…å…±æœ‰ç”¨' : 
            type === 'client' ? 'ä¾é ¼è€…èª¬æ˜ç”¨' : 'è¦‹ç©ãŸãŸãå°';
        
        document.getElementById('outputText').value = output;
        document.getElementById('outputModal').style.display = 'flex';
    }

    function copyToClipboard() {
        const copyText = document.getElementById("outputText");
        copyText.select();
        document.execCommand("copy");
        alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
    }
</script>

</body>
</html>