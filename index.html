<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼è­·å£« æ€è€ƒã‚³ãƒ³ãƒ‘ã‚¹ Ultimate</title>
    <!-- Google Fonts: Noto Serif JP (æ˜æœä½“) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500&family=Noto+Serif+JP:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Premium Color Palette */
            --primary-color: #102a43; /* ãƒŸãƒƒãƒ‰ãƒŠã‚¤ãƒˆãƒ–ãƒ«ãƒ¼ */
            --primary-light: #243b55;
            --premium-gold: #c5a059;  /* ã‚´ãƒ¼ãƒ«ãƒ‰ */
            --premium-gold-light: #e6c888;
            --accent-color: #d9534f;
            
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
            --input-bg: #fdfdfd;
            --input-border: #dbe2e8;
            
            --border-radius: 6px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --modal-overlay: rgba(16, 42, 67, 0.6);
        }

        body.dark-mode {
            --primary-color: #1a2634;
            --primary-light: #2c3e50;
            --premium-gold: #d4af37;
            --premium-gold-light: #f3e5ab;
            --accent-color: #ff6b6b;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --input-bg: #252525;
            --input-border: #444;
            --shadow: 0 4px 12px rgba(0,0,0,0.5);
            --modal-overlay: rgba(0,0,0,0.8);
        }

        * { box-sizing: border-box; }

        body {
            font-family: "Noto Sans JP", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        h1, h2, h3, h4, h5 { font-family: "Noto Serif JP", serif; letter-spacing: 0.05em; }

        /* Utility */
        .container { max-width: 1400px; margin: 0 auto; min-height: calc(100vh - 100px); }
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--input-border);
            border-top: 3px solid var(--primary-color);
            transition: all 0.3s ease;
        }
        .card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }

        h2 {
            font-size: 1.15rem; margin-top: 0; margin-bottom: 15px; color: var(--primary-color);
            border-bottom: 1px solid #eee; padding-bottom: 10px; display: flex; align-items: center;
        }
        h2::before { content: ''; display: inline-block; width: 6px; height: 18px; background-color: var(--premium-gold); margin-right: 10px; border-radius: 1px; }
        body.dark-mode h2 { border-bottom-color: #444; }
        
        input[type="text"], input[type="date"], input[type="number"], select, textarea {
            width: 100%; padding: 10px; border: 1px solid var(--input-border); border-radius: var(--border-radius);
            font-size: 0.95rem; margin-bottom: 8px; background-color: var(--input-bg); color: var(--text-color);
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--premium-gold); box-shadow: 0 0 0 3px rgba(197, 160, 89, 0.15); }
        
        select.template-select { font-size: 0.85rem; color: #555; background-color: rgba(0,0,0,0.02); margin-bottom: 10px; border: 1px solid transparent; cursor: pointer; }
        body.dark-mode select.template-select { background-color: rgba(255,255,255,0.05); color: #ccc; }

        /* Textarea Wrapper for Char Count */
        .textarea-wrapper { position: relative; width: 100%; }
        .col textarea { min-height: 300px; resize: vertical; line-height: 1.8; font-family: inherit; padding-bottom: 25px; /* space for counter */ }
        .char-count {
            position: absolute; bottom: 8px; right: 10px; font-size: 0.75rem; color: #999;
            background-color: rgba(255,255,255,0.8); padding: 2px 6px; border-radius: 4px; pointer-events: none;
        }
        body.dark-mode .char-count { background-color: rgba(0,0,0,0.5); color: #777; }

        /* Settings Textarea */
        #conflictDatabase { min-height: 120px; font-family: monospace; font-size: 0.85rem; }
        
        label { display: block; font-size: 0.8rem; font-weight: 600; color: #555; margin-bottom: 4px; font-family: "Noto Sans JP", sans-serif; }
        body.dark-mode label { color: #aaa; }

        /* Header */
        header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding: 15px 25px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            border-radius: var(--border-radius); box-shadow: var(--shadow); color: white; border-bottom: 2px solid var(--premium-gold);
        }
        .header-left h1 { font-size: 1.6rem; margin: 0; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .header-left span { font-family: "Noto Sans JP", sans-serif; font-weight: normal; font-size: 0.8rem; color: var(--premium-gold-light); margin-left: 10px; letter-spacing: 0.05em; }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .icon-btn {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); cursor: pointer; font-size: 1.2rem; color: white; padding: 8px; border-radius: 50%; transition: all 0.2s;
            display: flex; align-items: center; justify-content: center; width: 40px; height: 40px;
        }
        .icon-btn:hover { background-color: var(--premium-gold); border-color: var(--premium-gold); color: var(--primary-color); transform: scale(1.05); }
        .btn-text { font-size: 0.9rem; font-weight: 500; color: white; background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 5px; font-family: "Noto Sans JP", sans-serif; }
        .btn-text:hover { color: var(--premium-gold-light); }
        
        /* Layout */
        .case-header-grid { display: grid; gap: 20px; }
        .row-1 { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 20px; }
        .row-2 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        .main-columns { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        .col { display: flex; flex-direction: column; }

        .status-ok { color: #27ae60; font-weight: bold; }
        .status-warn { color: #c0392b; background-color: #fce4ec; border-color: #c0392b; font-weight: bold; }
        body.dark-mode .status-warn { background-color: #3e2723; }

        /* Conflict Alert */
        .input-group-with-btn { display: flex; gap: 5px; align-items: flex-start; }
        .btn-search {
            background: var(--input-bg); border: 1px solid var(--input-border); border-radius: var(--border-radius); cursor: pointer; padding: 10px 12px; color: #666; transition: all 0.2s;
        }
        .btn-search:hover { border-color: var(--premium-gold); color: #8a6d3b; background-color: rgba(197, 160, 89, 0.05); }
        .conflict-alert {
            display: none; background-color: var(--accent-color); color: white; font-size: 0.8rem; font-weight: bold; padding: 6px 10px; border-radius: 4px; margin-top: 4px; animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .conflict-detected input { border: 2px solid var(--accent-color) !important; background-color: #fff5f5 !important; }

        /* Fee Section */
        .fee-section { background-color: rgba(0,0,0,0.02); border: 1px solid var(--input-border); border-radius: var(--border-radius); padding: 15px; margin-top: 15px; }
        body.dark-mode .fee-section { background-color: rgba(255,255,255,0.03); }
        .fee-category-title { font-size: 0.85rem; font-weight: bold; color: var(--primary-color); margin-bottom: 8px; display: flex; align-items: center; font-family: "Noto Serif JP", serif; }
        .fee-category-title::before { background-color: var(--premium-gold); }
        .fee-row { display: flex; align-items: center; margin-bottom: 8px; }
        .fee-row label { width: 70px; margin-bottom: 0; font-size: 0.8rem; color: #666; }
        .fee-row input { flex: 1; text-align: right; padding: 6px 10px; }
        
        /* Buttons */
        .btn {
            background: linear-gradient(to bottom, var(--primary-color), #0a1f33); color: white; border: 1px solid var(--primary-color); padding: 10px 20px; border-radius: var(--border-radius);
            cursor: pointer; font-size: 0.9rem; font-weight: 500; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s; font-family: "Noto Sans JP", sans-serif;
        }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); background: var(--primary-color); }
        .btn-outline { background: transparent; border: 1px solid var(--primary-color); color: var(--primary-color); box-shadow: none; }
        .btn-outline:hover { background-color: rgba(16, 42, 67, 0.05); transform: none; }
        body.dark-mode .btn-outline { border-color: #64b5f6; color: #64b5f6; }

        /* ToDo */
        .todo-input-area { display: flex; gap: 10px; align-items: center; margin-bottom: 15px; }
        .todo-input-main { flex: 2; display: flex; align-items: center; gap: 5px; position: relative; }
        .mic-btn-mini { background: none; border: 1px solid #ccc; border-radius: 50%; cursor: pointer; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; color: #666; flex-shrink: 0; transition: all 0.2s; }
        .mic-btn-mini:hover { border-color: var(--premium-gold); color: var(--premium-gold); }
        .mic-btn-mini.recording-active { color: var(--accent-color); border-color: var(--accent-color); background-color: #fff0f0; }
        .todo-list { list-style: none; padding: 0; margin: 0; }
        .todo-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #eee; gap: 10px; transition: background 0.2s; }
        .todo-item:hover { background-color: rgba(0,0,0,0.01); }
        .btn-calendar { background: none; border: none; cursor: pointer; font-size: 1.2rem; margin-right: 5px; transition: transform 0.2s; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; width: 30px; height: 30px; border-radius: 50%; }
        .btn-calendar:hover { transform: scale(1.2); }

        /* Output & Footer */
        .output-area { display: flex; gap: 20px; justify-content: center; margin-top: 40px; margin-bottom: 30px; padding-top: 30px; border-top: 1px solid #ddd; }
        .output-btn-group { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .output-desc { font-size: 0.75rem; color: #888; margin-top: 2px; }
        .utility-footer { text-align: center; margin-bottom: 40px; display: flex; justify-content: center; gap: 20px; }
        .btn-text-sub { background: none; border: none; color: #999; font-size: 0.8rem; cursor: pointer; text-decoration: underline; font-family: "Noto Sans JP", sans-serif; }
        .btn-text-sub:hover { color: var(--primary-color); }
        .main-footer { text-align: center; padding: 20px; color: #999; font-size: 0.8rem; border-top: 1px solid #eee; background-color: var(--card-bg); }

        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--modal-overlay); backdrop-filter: blur(2px); justify-content: center; align-items: center; z-index: 1000; }
        .modal { background: var(--card-bg); padding: 30px; width: 80%; max-width: 800px; border-radius: 8px; display: flex; flex-direction: column; max-height: 90vh; color: var(--text-color); box-shadow: 0 15px 30px rgba(0,0,0,0.2); border: 1px solid var(--input-border); }
        .modal-header { border-bottom: 2px solid var(--premium-gold); }
        .modal-header h3 { font-family: "Noto Serif JP", serif; color: var(--primary-color); }
        .modal-body { overflow-y: auto; padding-bottom: 10px; }

        .guide-section { background-color: #f8f9fa; border-radius: 6px; padding: 15px; margin-bottom: 15px; border-left: 4px solid var(--primary-color); }
        body.dark-mode .guide-section { background-color: rgba(255,255,255,0.05); }
        .guide-step h5 { color: var(--primary-color); font-family: "Noto Serif JP", serif; border-bottom: 1px dashed #ccc; padding-bottom: 5px; margin-bottom: 10px; font-size: 1.05rem; }
        .guide-text { line-height: 1.7; font-size: 0.9rem; }

        /* Print CSS - ç´™å°åˆ·æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        @media print {
            body { background-color: white; color: black; font-size: 10pt; }
            .container { max-width: 100%; margin: 0; padding: 0; }
            header, .header-right, .btn-search, .btn-calendar, #todo-section, .output-area, .utility-footer, .main-footer, .mic-btn-mini, .template-select, .icon-btn { display: none !important; }
            .card { border: none; box-shadow: none; margin-bottom: 10px; padding: 0; border-top: 2px solid #000; }
            h2 { border-bottom: 1px solid #000; color: #000; font-size: 12pt; margin-bottom: 5px; padding-bottom: 2px; }
            h2::before { display: none; }
            .main-columns { display: block; }
            .col { margin-bottom: 20px; page-break-inside: avoid; }
            textarea { border: none; resize: none; min-height: auto; height: auto; overflow: visible; font-family: "Noto Serif JP", serif; }
            input, select { border: none; background: transparent; }
            /* å°åˆ·æ™‚ã«æ ã‚’æ¶ˆã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã ã‘è¦‹ã›ã‚‹é¢¨ã«ã™ã‚‹ */
            input[type="text"], textarea { background: transparent; padding: 0; margin: 0; }
            .fee-section { border: 1px solid #ccc; background: none; }
        }

        @media (max-width: 900px) {
            .row-1, .row-2, .main-columns { grid-template-columns: 1fr; }
            .todo-input-area { flex-direction: column; align-items: stretch; }
            .output-area { flex-direction: column; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="header-left">
            <h1>å¼è­·å£« æ€è€ƒã‚³ãƒ³ãƒ‘ã‚¹<span>Ultimate</span></h1>
        </div>
        <div class="header-right">
            <button class="btn-text" onclick="openModal('usageModal')"><span>ğŸ“–</span> ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</button>
            <button class="icon-btn" onclick="openModal('settingsModal')" title="è¨­å®š">âš™ï¸</button>
        </div>
    </header>

    <!-- Case Header -->
    <section class="card" id="case-header">
        <div class="case-header-grid">
            <div class="row-1">
                <div><label>æ¡ˆä»¶å</label><input type="text" id="caseName" placeholder="ä¾‹ï¼šã€‡ã€‡æ° å»ºç‰©æ˜æ¸¡è«‹æ±‚äº‹ä»¶" class="save-target"></div>
                <div><label>ä¾é ¼è€…å</label><input type="text" id="clientName" placeholder="å±±ç”° å¤ªéƒ" class="save-target"></div>
                <div>
                    <label>ç›¸æ‰‹æ–¹ï¼ˆ<span style="color:var(--accent-color);">â€»è‡ªå‹•ãƒã‚§ãƒƒã‚¯</span>ï¼‰</label>
                    <div class="input-group-with-btn" id="opponentGroup">
                        <div style="flex:1;">
                            <input type="text" id="opponentName" placeholder="éˆ´æœ¨ æ¬¡éƒ" oninput="checkConflict()" class="save-target">
                            <div id="conflictAlert" class="conflict-alert">âš ï¸ ã€å—ä»»ä¸å¯ã€‘éå»ã®ç›¸æ‰‹æ–¹ãƒªã‚¹ãƒˆã«å«ã¾ã‚Œã¦ã„ã¾ã™ï¼</div>
                        </div>
                        <button class="btn-search" onclick="openCalendarSearch()" title="Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ¤œç´¢">ğŸ” Calendar</button>
                    </div>
                </div>
                <div>
                    <label>åˆ†é‡</label>
                    <select id="field" class="save-target">
                        <option value="å‚µæ¨©å›å">å‚µæ¨©å›å</option><option value="é›¢å©š">é›¢å©š</option><option value="ç›¸ç¶š">ç›¸ç¶š</option><option value="åŠ´åƒ">åŠ´åƒ</option><option value="ä¸å‹•ç”£">ä¸å‹•ç”£</option><option value="äº¤é€šäº‹æ•…">äº¤é€šäº‹æ•…</option><option value="ä¼æ¥­æ³•å‹™">ä¼æ¥­æ³•å‹™</option><option value="åˆ‘äº‹">åˆ‘äº‹</option><option value="ãã®ä»–">ãã®ä»–</option>
                    </select>
                </div>
            </div>
            <div class="row-2">
                <div>
                    <label>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                    <select id="status" class="save-target">
                        <option value="ç›¸è«‡ä¸­">ç›¸è«‡ä¸­</option><option value="å—ä»»">å—ä»»</option><option value="äº¤æ¸‰ä¸­">äº¤æ¸‰ä¸­</option><option value="èª¿åœ">èª¿åœ</option><option value="è¨´è¨Ÿ">è¨´è¨Ÿ</option>
                    </select>
                </div>
                <div><label>æœ€é‡è¦æœŸé™</label><input type="date" id="deadline" class="save-target"></div>
                <div class="conflict-check-group">
                    <label>åˆ©ç›Šç›¸åãƒã‚§ãƒƒã‚¯</label>
                    <select id="conflictCheck" onchange="updateConflictColor(this)" class="save-target">
                        <option value="æœªç¢ºèª">æœªç¢ºèª</option><option value="OK" class="status-ok">OKï¼ˆå•é¡Œãªã—ï¼‰</option><option value="è¦æ³¨æ„" class="status-warn">è¦æ³¨æ„ï¼è¦ç¢ºèª</option>
                    </select>
                </div>
            </div>
        </div>
    </section>

    <!-- Main 3 Columns -->
    <div class="main-columns">
        <div class="col card">
            <h2>ç›¸è«‡ãƒ»äº‹å®Ÿé–¢ä¿‚</h2>
            <select class="template-select" onchange="insertTemplate('facts', this.value); this.value='';" >
                <option value="" disabled selected>â–¼ ã‚ˆãã‚ã‚‹ç›¸è«‡é››å½¢ã‚’æŒ¿å…¥</option>
                <optgroup label="ä¸€èˆ¬æ°‘äº‹"><option value="debt">å‚µæ¨©å›å</option><option value="realestate">ä¸å‹•ç”£ï¼ˆè³ƒè²¸ï¼‰</option><option value="traffic">äº¤é€šäº‹æ•…</option><option value="internet">ãƒãƒƒãƒˆèª¹è¬—ä¸­å‚·</option></optgroup>
                <optgroup label="å®¶äº‹ãƒ»ç›¸ç¶š"><option value="divorce">é›¢å©š</option><option value="inheritance">ç›¸ç¶š</option><option value="guardianship">æˆå¹´å¾Œè¦‹</option></optgroup>
                <optgroup label="ä¼æ¥­ãƒ»åˆ‘äº‹"><option value="labor">åŠ´åƒ</option><option value="corporate">ä¼æ¥­æ³•å‹™</option><option value="bankruptcy">ç ´ç”£</option><option value="criminal">åˆ‘äº‹äº‹ä»¶</option></optgroup>
            </select>
            <div class="textarea-wrapper">
                <textarea id="facts" class="save-target" placeholder="ãƒ»æ™‚ç³»åˆ—&#10;ãƒ»ç›¸è«‡è€…ãŒä¸»å¼µã™ã‚‹äº‹å®Ÿ&#10;ãƒ»è¨¼æ‹ ã®æœ‰ç„¡" oninput="updateCharCount('facts')"></textarea>
                <div id="facts-count" class="char-count">0æ–‡å­—</div>
            </div>
        </div>

        <div class="col card">
            <h2>è«–ç‚¹ãƒ»åˆ¤ä¾‹ãƒ¡ãƒ¢</h2>
            <select class="template-select" onchange="insertTemplate('issues', this.value); this.value='';">
                <option value="" disabled selected>â–¼ èª¿æŸ»ãƒ»æ¤œè¨ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’æŒ¿å…¥</option>
                <optgroup label="æ³•çš„æ¤œè¨"><option value="requirements">è¦ä»¶äº‹å®Ÿ</option><option value="keywords">æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰</option><option value="timeline">æ™‚åŠ¹ãƒ»æœŸé–“</option><option value="evidence">è¨¼æ‹ ä¸€è¦§</option><option value="risk">ãƒªã‚¹ã‚¯æ•´ç†</option></optgroup>
                <optgroup label="è¨ˆç®—ãƒ»åŸºæº–"><option value="negligence">éå¤±å‰²åˆ</option><option value="compensation">æ…°è¬æ–™åŸºæº–</option><option value="child_support">é¤Šè‚²è²»ç®—å®šè¡¨</option><option value="sentencing">é‡åˆ‘ç›¸å ´</option></optgroup>
            </select>
            <div class="textarea-wrapper">
                <textarea id="issues" class="save-target" placeholder="ãƒ»æ³•çš„æ§‹æˆ&#10;ãƒ»äº‰ç‚¹ã¨ãªã‚Šãã†ãªäº‹å®Ÿ&#10;ãƒ»ãƒªã‚µãƒ¼ãƒãŒå¿…è¦ãªåˆ¤ä¾‹" oninput="updateCharCount('issues')"></textarea>
                <div id="issues-count" class="char-count">0æ–‡å­—</div>
            </div>
        </div>

        <div class="col card">
            <h2>æ–¹é‡ãƒ»ãƒªã‚¹ã‚¯æ•´ç†</h2>
            <select class="template-select" onchange="insertTemplate('strategy', this.value); this.value='';">
                <option value="" disabled selected>â–¼ å¯¾å¿œãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ¡ˆã‚’æŒ¿å…¥</option>
                <optgroup label="äº¤æ¸‰ãƒ»é€šçŸ¥"><option value="notice">å†…å®¹è¨¼æ˜</option><option value="negotiation">äº¤æ¸‰ãƒ»ç¤ºè«‡</option><option value="notary">å…¬æ­£è¨¼æ›¸</option></optgroup>
                <optgroup label="è£åˆ¤æ‰€æ‰‹ç¶š"><option value="mediation">èª¿åœãƒ»ADR</option><option value="litigation">è¨´è¨Ÿæèµ·</option><option value="dunning">æ”¯æ‰•ç£ä¿ƒ</option><option value="provisional">ä¿å…¨å‡¦åˆ†</option><option value="settlement">å³æ±ºå’Œè§£</option></optgroup>
                <optgroup label="ãã®ä»–"><option value="complaint">åˆ‘äº‹å‘Šè¨´</option><option value="decline">å—ä»»è¦‹é€ã‚Š</option></optgroup>
            </select>
            <div class="textarea-wrapper">
                <textarea id="strategy" class="save-target" placeholder="ãƒ»è§£æ±ºã®ã‚´ãƒ¼ãƒ«è¨­å®š&#10;ãƒ»äº¤æ¸‰/è¨´è¨Ÿã®é¸æŠ&#10;ãƒ»æ•—è¨´ãƒªã‚¹ã‚¯" oninput="updateCharCount('strategy')"></textarea>
                <div id="strategy-count" class="char-count">0æ–‡å­—</div>
            </div>

            <!-- Fee Section -->
            <div class="fee-section">
                <h3>è²»ç”¨ç›®å®‰ï¼ˆç¨è¾¼ï¼‰</h3>
                <div class="fee-category">
                    <div class="fee-category-title">1. ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒ¼ã‚¸</div>
                    <div class="fee-row"><label>å˜ä¾¡</label><input type="text" id="feeTimeCharge" class="save-target" placeholder="ä¾‹ï¼š3.3"><span class="fee-unit">ä¸‡å††/1h</span></div>
                </div>
                <div class="fee-category">
                    <div class="fee-category-title">2. ç€æ‰‹é‡‘ãƒ»å ±é…¬é‡‘</div>
                    <div class="fee-row"><label>ç€æ‰‹é‡‘</label><input type="text" id="feeStart" class="save-target" placeholder="ä¾‹ï¼š8.8%"><span class="fee-unit"></span></div>
                    <div class="fee-row"><label>å ±é…¬é‡‘</label><input type="text" id="feeSuccess" class="save-target" placeholder="ä¾‹ï¼š17.6%"><span class="fee-unit"></span></div>
                </div>
                <div class="fee-category" style="border-bottom:none;">
                    <div class="fee-category-title">3. æ‰‹æ•°æ–™ï¼ˆå®šé¡ï¼‰</div>
                    <div class="fee-row"><label>å®šé¡</label><input type="text" id="feeSpot" class="save-target" placeholder="ä¾‹ï¼š5.5"><span class="fee-unit">ä¸‡å††</span></div>
                </div>
                <label style="margin-top:5px;">å‚™è€ƒ</label>
                <textarea id="feeRemarks" class="save-target" style="min-height:60px;" placeholder="æ—¥å½“ãƒ»å®Ÿè²»ç­‰"></textarea>
            </div>
        </div>
    </div>

    <!-- ToDo Section -->
    <section class="card" id="todo-section">
        <h2>ToDoï¼æœŸé™ç®¡ç†</h2>
        <select id="todo-preset-select" class="template-select" onchange="setQuickTodo(this.value); this.value='';" style="width:100%;">
            <option value="" disabled selected>â–¼ ã‚ˆãã‚ã‚‹ã‚¿ã‚¹ã‚¯ã‚’é¸æŠ</option>
            <option value="å§”ä»»å¥‘ç´„æ›¸ã®ä½œæˆ">å§”ä»»å¥‘ç´„æ›¸ã®ä½œæˆ</option><option value="è¨´çŠ¶ãƒ»æ›¸é¢ã®èµ·æ¡ˆ">è¨´çŠ¶ãƒ»æ›¸é¢ã®èµ·æ¡ˆ</option><option value="è¨¼æ‹ è³‡æ–™ã®ç²¾æŸ»">è¨¼æ‹ è³‡æ–™ã®ç²¾æŸ»</option><option value="ä¾é ¼è€…ã¸ã®å ±å‘Šé€£çµ¡">ä¾é ¼è€…ã¸ã®å ±å‘Šé€£çµ¡</option><option value="æœŸæ—¥å‡ºé ­ãƒ»å ±å‘Š">æœŸæ—¥å‡ºé ­ãƒ»å ±å‘Š</option>
        </select>
        
        <div class="todo-input-area">
            <div class="todo-input-main">
                <input type="text" id="newTodoText" placeholder="ã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›">
                <button onclick="toggleSpeech('newTodoText', this)" class="mic-btn-mini" title="éŸ³å£°å…¥åŠ›">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
                </button>
            </div>
            <div style="flex:1;"><input type="date" id="newTodoDate"></div>
            <div style="width:100px;"><select id="newTodoPriority"><option value="é«˜">é«˜</option><option value="ä¸­" selected>ä¸­</option><option value="ä½">ä½</option></select></div>
            <button class="btn" onclick="addTodo()">è¿½åŠ </button>
        </div>
        <ul id="todoList" class="todo-list"></ul>
    </section>

    <!-- Output & Utility -->
    <footer class="output-area">
        <div class="output-btn-group"><button class="btn" style="background-color:#34495e;" onclick="generateOutput('internal')">â‘  äº‹å‹™æ‰€å†…å…±æœ‰ç”¨</button></div>
        <div class="output-btn-group"><button class="btn" onclick="generateOutput('client')">â‘¡ ä¾é ¼è€…èª¬æ˜ç”¨</button></div>
        <div class="output-btn-group"><button class="btn" style="background-color:#27ae60; border-color:#27ae60;" onclick="generateOutput('estimate')">â‘¢ è¦‹ç©ãŸãŸãç”¨</button></div>
    </footer>

    <div class="utility-footer">
        <button class="btn-text-sub" onclick="fillDemoData()">ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›</button>
        <button class="btn-text-sub" onclick="clearData()">å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢</button>
    </div>
</div>

<footer class="main-footer">Ultimate Edition v1.0 Â© 2026 SPC</footer>

<!-- Settings Modal -->
<div class="modal-overlay" id="settingsModal">
    <div class="modal modal-sm">
        <div class="modal-header"><h3>è¨­å®š</h3><button class="btn btn-sm btn-outline" onclick="closeModal('settingsModal')">Ã—</button></div>
        <div class="modal-body">
            <div class="settings-row"><label>ç”»é¢ãƒ†ãƒ¼ãƒ</label><div class="theme-options"><div class="theme-option active" id="themeLight" onclick="setTheme('light')">Light</div><div class="theme-option" id="themeDark" onclick="setTheme('dark')">Dark</div></div></div>
            <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
            <div class="settings-row"><label>ãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰</label>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-outline" onclick="exportData()" style="flex:1;">ä¿å­˜ï¼ˆJSONï¼‰</button>
                    <button class="btn btn-outline" onclick="document.getElementById('importFile').click()" style="flex:1;">å¾©å…ƒï¼ˆJSONï¼‰</button>
                    <input type="file" id="importFile" style="display:none;" onchange="importData(this)">
                </div>
            </div>
            <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
            <div class="settings-row">
                <label>åŸºæœ¬æƒ…å ± & é€£æº</label>
                <div style="margin-bottom:10px;"><input type="text" id="lawyerOffice" placeholder="äº‹å‹™æ‰€å" class="save-target"></div>
                <div style="margin-bottom:10px;"><input type="text" id="lawyerName" placeholder="å¼è­·å£«å" class="save-target"></div>
                <div><input type="text" id="googleAccount" class="save-target" placeholder="Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆ(ãƒ¡ãƒ¢)"></div>
            </div>
            <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
            <div class="settings-row">
                <label>åˆ©ç›Šç›¸åãƒã‚§ãƒƒã‚¯ç”¨DB</label>
                <textarea id="conflictDatabase" class="save-target" placeholder="ä½è—¤æ¬¡éƒ&#13;&#10;éˆ´æœ¨ä¸‰éƒ"></textarea>
            </div>
        </div>
        <div style="margin-top:15px; text-align:right;"><button class="btn" onclick="closeModal('settingsModal')">é–‰ã˜ã‚‹</button></div>
    </div>
</div>

<!-- Usage Guide Modal -->
<div class="modal-overlay" id="usageModal">
    <div class="modal modal-sm" style="max-width:650px;">
        <div class="modal-header"><h3>ä½¿ã„æ–¹ãƒ»æ´»ç”¨ã‚¬ã‚¤ãƒ‰</h3><button class="btn btn-sm btn-outline" onclick="closeModal('usageModal')">Ã—</button></div>
        <div class="modal-body">
            <div class="guide-section"><h4 style="margin:0 0 5px 0; color:var(--primary-color);">ğŸ“Œ Ultimate Edition</h4><p class="guide-text">å®Ÿå‹™ã®ä¿¡é ¼æ€§ã‚’é«˜ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆã€å°åˆ·æœ€é©åŒ–æ©Ÿèƒ½ã‚’æ­è¼‰ã€‚</p></div>
            <div class="guide-step"><h5>Step 1. æº–å‚™ã¨åˆ©ç›Šç›¸åãƒã‚§ãƒƒã‚¯</h5><p class="guide-text">ã€Œè¨­å®šã€ã§äº‹å‹™æ‰€æƒ…å ±ã‚„ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ç™»éŒ²ã€‚ã€Œç›¸æ‰‹æ–¹ã€æ¬„ã§è‡ªå‹•ç…§åˆï¼†ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ¤œç´¢ã€‚</p></div>
            <div class="guide-step"><h5>Step 2. æ€è€ƒæ•´ç†ã¨æ–‡å­—æ•°ç¢ºèª</h5><p class="guide-text">å„æ¬„å³ä¸‹ã®æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’è¦‹ãªãŒã‚‰ã€æ›¸é¢ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ æ„Ÿã‚’æŠŠæ¡ã—ã¤ã¤å…¥åŠ›ã€‚</p></div>
            <div class="guide-step"><h5>Step 3. ã‚¿ã‚¹ã‚¯ã¨ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h5><p class="guide-text">ToDoã‚’Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¸ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ç™»éŒ²ã€‚æŠœã‘æ¼ã‚Œã‚’é˜²ãã¾ã™ã€‚</p></div>
            <div class="guide-step"><h5>Step 4. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨å°åˆ·</h5><p class="guide-text">è¨­å®šã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’JSONä¿å­˜å¯èƒ½ã€‚ã¾ãŸã€å°åˆ·ï¼ˆCtrl+Pï¼‰æ™‚ã¯è‡ªå‹•ã§ãã‚Œã„ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«ãªã‚Šã¾ã™ã€‚</p></div>
        </div>
        <div style="margin-top:15px; text-align:right;"><button class="btn" onclick="closeModal('usageModal')">é–‰ã˜ã‚‹</button></div>
    </div>
</div>

<!-- Output Modal -->
<div class="modal-overlay" id="outputModal">
    <div class="modal">
        <div class="modal-header"><h3 id="modalTitle">å‡ºåŠ›çµæœ</h3><button class="btn btn-sm btn-outline" onclick="closeModal('outputModal')">é–‰ã˜ã‚‹</button></div>
        <div class="modal-body"><textarea id="outputText"></textarea></div>
        <div style="margin-top:10px; display:flex; justify-content:flex-end; gap:10px;"><button class="btn" onclick="copyToClipboard()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button></div>
    </div>
</div>

<script>
    // --- Constant Data (Templates) ---
    const TEMPLATES = {
        debt: "ã€ç›¸è«‡ç¨®åˆ¥ã€‘å‚µæ¨©å›å\nã€å‚µæ¨©ã®ç¨®é¡ã€‘å£²æ›é‡‘ãƒ»è²¸é‡‘\nã€å¥‘ç´„æ›¸ã®æœ‰ç„¡ã€‘ã‚ã‚Šãƒ»ãªã—\nã€ç›¸æ‰‹æ–¹ã®å¯¾å¿œã€‘éŸ³ä¿¡ä¸é€šãƒ»æ”¯æ‰•æ„æ€ã‚ã‚Šãƒ»è³‡åŠ›ä¸æ˜\nã€å¸Œæœ›ã™ã‚‹è§£æ±ºã€‘æ—©æœŸå›åãƒ»åˆ†å‰²æ‰•ã„ã§ã‚‚å¯ãƒ»å¼·ç¡¬æ‰‹æ®µè¾ã•ãš\n\nã€è©³ç´°ãªäº‹å®ŸçµŒç·¯ã€‘\n",
        divorce: "ã€ç›¸è«‡ç¨®åˆ¥ã€‘é›¢å©šãƒ»ç”·å¥³å•é¡Œ\nã€å½“äº‹è€…å±æ€§ã€‘å©šå§»å¹´æ•°â—‹å¹´ãƒ»å­â—‹äººï¼ˆâ—‹æ­³ï¼‰\nã€ä¸»ãªäº‰ç‚¹ã€‘è¦ªæ¨©ãƒ»é¤Šè‚²è²»ãƒ»è²¡ç”£åˆ†ä¸ãƒ»æ…°è¬æ–™ãƒ»å¹´é‡‘åˆ†å‰²\nã€ç›¸æ‰‹æ–¹ã®æ…‹åº¦ã€‘é›¢å©šæ‹’å¦ãƒ»æ¡ä»¶æ¬¡ç¬¬ãƒ»ãƒ¢ãƒ©ãƒãƒ©æ°—å‘³\nã€åˆ¥å±…ã®æœ‰ç„¡ã€‘åˆ¥å±…ä¸­ï¼ˆæœŸé–“â—‹ãƒ¶æœˆï¼‰\n\nã€è©³ç´°ãªç›¸è«‡å†…å®¹ã€‘\n",
        realestate: "ã€ç›¸è«‡ç¨®åˆ¥ã€‘ä¸å‹•ç”£ï¼ˆè³ƒè²¸ãƒ»æ˜æ¸¡ã—ï¼‰\nã€ç‰©ä»¶æ¦‚è¦ã€‘å±…ä½ç”¨ãƒ»äº‹æ¥­ç”¨ï¼ˆæœˆé¡è³ƒæ–™â—‹ä¸‡å††ï¼‰\nã€æ»ç´æœŸé–“ã€‘â—‹ãƒ¶æœˆåˆ†\nã€ä¿¡é ¼é–¢ä¿‚ç ´å£Šã€‘ç”¨æ³•éµå®ˆé•åãƒ»é¨’éŸ³ãƒ»ç„¡æ–­è»¢è²¸\nã€å¥‘ç´„è§£é™¤é€šçŸ¥ã€‘æœªé€ä»˜ãƒ»é€ä»˜æ¸ˆã¿\n\nã€è©³ç´°ãªäº‹å®Ÿé–¢ä¿‚ã€‘\n",
        labor: "ã€ç›¸è«‡ç¨®åˆ¥ã€‘åŠ´åƒãƒˆãƒ©ãƒ–ãƒ«\nã€ç«‹å ´ã€‘ä¼æ¥­å´ãƒ»åŠ´åƒè€…å´\nã€å•é¡Œã€‘ä¸å½“è§£é›‡ãƒ»æ®‹æ¥­ä»£æœªæ‰•ã„ãƒ»ãƒ‘ãƒ¯ãƒãƒ©ãƒ»æ‡²æˆ’å‡¦åˆ†\nã€å°±æ¥­è¦å‰‡ã€‘ã‚ã‚Šãƒ»ãªã—\nã€è¨¼æ‹ ã€‘ã‚¿ã‚¤ãƒ ã‚«ãƒ¼ãƒ‰ãƒ»ãƒ¡ãƒ¼ãƒ«ãƒ»éŒ²éŸ³\n\nã€è©³ç´°ãªçµŒç·¯ã€‘\n",
        inheritance: "ã€ç›¸è«‡ç¨®åˆ¥ã€‘ç›¸ç¶šãƒ»éºè¨€\nã€è¢«ç›¸ç¶šäººã€‘æ­»äº¡æ—¥ï¼šâ—‹å¹´â—‹æœˆâ—‹æ—¥\nã€ç›¸ç¶šäººã€‘é…å¶è€…ã€å­â—‹å\nã€éºç”£å†…å®¹ã€‘ä¸å‹•ç”£ã€é è²¯é‡‘ï¼ˆç´„â—‹ä¸‡å††ï¼‰ã€æ ªå¼\nã€éºè¨€æ›¸ã®æœ‰ç„¡ã€‘è‡ªç­†è¨¼æ›¸ãƒ»å…¬æ­£è¨¼æ›¸ãƒ»ãªã—\nã€äº‰ç‚¹ã€‘éºç”£åˆ†å‰²å”è­°ãƒ»å¯„ä¸åˆ†ãƒ»ç‰¹åˆ¥å—ç›Šãƒ»éºç•™åˆ†\n\nã€è©³ç´°ãªç›¸è«‡å†…å®¹ã€‘\n",
        traffic: "ã€ç›¸è«‡ç¨®åˆ¥ã€‘äº¤é€šäº‹æ•…\nã€äº‹æ•…æ…‹æ§˜ã€‘ç‰©ä»¶äº‹æ•…ãƒ»äººèº«äº‹æ•…\nã€æ€ªæˆ‘ã®çŠ¶æ³ã€‘æ²»ç™‚ä¸­ãƒ»ç—‡çŠ¶å›ºå®šï¼ˆç­‰ç´šâ—‹ç´šï¼‰\nã€éå¤±å‰²åˆã®äº‰ã„ã€‘ã‚ã‚Šãƒ»ãªã—ï¼ˆç›¸æ‰‹æ–¹ä¸»å¼µï¼šâ—‹å¯¾â—‹ï¼‰\nã€æå®³è³ å„Ÿé¡ã€‘æç¤ºé¡ï¼šâ—‹ä¸‡å††\n\nã€è©³ç´°ãªäº‹æ•…çŠ¶æ³ã€‘\n",
        internet: "ã€ç›¸è«‡ç¨®åˆ¥ã€‘ãƒãƒƒãƒˆèª¹è¬—ä¸­å‚·\nã€å¯¾è±¡ã‚µã‚¤ãƒˆã€‘X(Twitter)ãƒ»5chãƒ»Googleå£ã‚³ãƒŸãƒ»Instagram\nã€æŠ•ç¨¿å†…å®¹ã€‘åèª‰æ¯€æãƒ»ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¾µå®³ãƒ»ä¾®è¾±\nã€æŠ•ç¨¿æ—¥æ™‚ã€‘â—‹å¹´â—‹æœˆâ—‹æ—¥\nã€è¨¼æ‹ ä¿å­˜ã€‘URLãƒ»ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆç¢ºä¿æ¸ˆã¿\n\nã€è©³ç´°ãªæŠ•ç¨¿å†…å®¹ã€‘\n",
        guardianship: "ã€ç›¸è«‡ç¨®åˆ¥ã€‘æˆå¹´å¾Œè¦‹\nã€æœ¬äººã€‘å¹´é½¢ï¼šâ—‹æ­³ã€è¨ºæ–­åï¼šèªçŸ¥ç—‡ãªã©\nã€é¡å‹ã®è¦‹è¾¼ã¿ã€‘å¾Œè¦‹ãƒ»ä¿ä½ãƒ»è£œåŠ©\nã€è²¡ç”£çŠ¶æ³ã€‘ä¸å‹•ç”£ã€é è²¯é‡‘\nã€å€™è£œè€…ã€‘è¦ªæ—ãƒ»å°‚é–€è·å¸Œæœ›\n\nã€è©³ç´°ãªäº‹æƒ…ã€‘\n",
        corporate: "ã€ç›¸è«‡ç¨®åˆ¥ã€‘ä¼æ¥­æ³•å‹™ãƒ»å¥‘ç´„æ›¸ãƒã‚§ãƒƒã‚¯\nã€å¥‘ç´„é¡å‹ã€‘æ¥­å‹™å§”è¨—ãƒ»å£²è²·ãƒ»ç§˜å¯†ä¿æŒãƒ»ä»£ç†åº—\nã€å½“æ–¹ã®ç«‹å ´ã€‘å§”è¨—å´ãƒ»å—è¨—å´\nã€ç‰¹ã«æ‡¸å¿µã—ã¦ã„ã‚‹ç‚¹ã€‘æå®³è³ å„Ÿæ¡é …ãƒ»è§£é™¤æ¡é …ãƒ»ç«¶æ¥­é¿æ­¢\n\nã€è©³ç´°ãªç›¸è«‡å†…å®¹ã€‘\n",
        bankruptcy: "ã€ç›¸è«‡ç¨®åˆ¥ã€‘ç ´ç”£ãƒ»å‚µå‹™æ•´ç†\nã€ä¸»ä½“ã€‘æ³•äººãƒ»å€‹äºº\nã€è² å‚µç·é¡ã€‘ç´„â—‹ä¸‡å††ï¼ˆå‚µæ¨©è€…æ•°ï¼šâ—‹ç¤¾ï¼‰\nã€è³‡ç”£çŠ¶æ³ã€‘ç¾é‡‘ãƒ»é é‡‘ãƒ»å£²æ›é‡‘ãƒ»ä¸å‹•ç”£\nã€ç¨é‡‘æ»ç´ã€‘ã‚ã‚Šãƒ»ãªã—\n\nã€è©³ç´°ãªçµŒå–¶/ç”Ÿæ´»çŠ¶æ³ã€‘\n",
        criminal: "ã€ç›¸è«‡ç¨®åˆ¥ã€‘åˆ‘äº‹äº‹ä»¶\nã€ç½ªåã€‘\nã€èº«æŸ„ã€‘é€®æ•ãƒ»å‹¾ç•™ãƒ»åœ¨å®…\nã€å‰ç§‘ãƒ»å‰æ­´ã€‘\nã€è¢«å®³å¼å„Ÿã€‘æœªæ¸ˆãƒ»ç¤ºè«‡äº¤æ¸‰ä¸­\nã€èªå¦ã€‘èªã‚ã¦ã„ã‚‹ãƒ»å¦èªãƒ»é»™ç§˜\n\nã€è©³ç´°ãªäº‹å®Ÿé–¢ä¿‚ã€‘\n",
        requirements: "ã€è¦ä»¶äº‹å®Ÿã®æ•´ç†ã€‘\n1. è«‹æ±‚åŸå› äº‹å®Ÿï¼š\n   ãƒ»\n   ãƒ»\n2. æŠ—å¼äº‹å®Ÿï¼š\n   ãƒ»\n   ãƒ»\n3. å†æŠ—å¼ï¼š\n   ãƒ»\n",
        keywords: "ã€æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å€™è£œã€‘\nãƒ»ä¸»èªï¼š\nãƒ»è¡Œç‚ºï¼š\nãƒ»æ³•çš„è©•ä¾¡ï¼š\nãƒ»é¡ä¼¼åˆ¤ä¾‹ã®åˆ¤æ–­æ çµ„ã¿ï¼š\n",
        timeline: "ã€æ™‚åŠ¹ãƒ»æœŸé–“åˆ¶é™ãƒã‚§ãƒƒã‚¯ã€‘\nãƒ»æ¨©åˆ©è¡Œä½¿å¯èƒ½æ—¥ï¼š\nãƒ»æ¶ˆæ»…æ™‚åŠ¹å®Œæˆæ—¥ï¼š\nãƒ»é™¤æ–¥æœŸé–“ï¼š\nãƒ»æ™‚åŠ¹æ›´æ–°æªç½®ã®æœ‰ç„¡ï¼š\n",
        evidence: "ã€è¨¼æ‹ ä¸€è¦§ã€‘\n[æ›¸è¨¼]\nãƒ»ç”²1å·è¨¼ï¼š\nãƒ»ç”²2å·è¨¼ï¼š\n\n[äººè¨¼]\nãƒ»è¨¼äººï¼š\nãƒ»é™³è¿°æ›¸ï¼š\n",
        risk: "ã€ãƒªã‚¹ã‚¯ãƒ»äº‰ç‚¹æ•´ç†ã€‘\nãƒ»å½“æ–¹ã®å¼±ç‚¹ï¼š\nãƒ»ç›¸æ‰‹æ–¹ã®äºˆæƒ³ã•ã‚Œã‚‹åè«–ï¼š\nãƒ»èªå®¹ã•ã‚Œã‚‹å¯èƒ½æ€§ï¼ˆå‹è¨´è¦‹è¾¼ã¿ï¼‰ï¼šâ—‹ï¼…ç¨‹åº¦\nãƒ»ã‚³ã‚¹ãƒˆå€’ã‚Œã®ãƒªã‚¹ã‚¯ï¼š\n",
        negligence: "ã€éå¤±å‰²åˆæ¤œè¨ã€‘\nãƒ»åˆ¥å†Šåˆ¤ä¾‹ã‚¿ã‚¤ãƒ ã‚ºå›³ç•ªï¼š\nãƒ»åŸºæœ¬éå¤±å‰²åˆï¼šå½“æ–¹â—‹ï¼šç›¸æ‰‹æ–¹â—‹\nãƒ»ä¿®æ­£è¦ç´ ï¼ˆå½“æ–¹ï¼‰ï¼š\nãƒ»ä¿®æ­£è¦ç´ ï¼ˆç›¸æ‰‹æ–¹ï¼‰ï¼š\n",
        compensation: "ã€æ…°è¬æ–™ç®—å®šåŸºæº–ï¼ˆèµ¤æœ¬/é’æœ¬ï¼‰ã€‘\nãƒ»é€šé™¢æœŸé–“ï¼šâ—‹ãƒ¶æœˆï¼ˆå®Ÿé€šé™¢â—‹æ—¥ï¼‰\nãƒ»åŸºæº–é¡ï¼šâ—‹ä¸‡å††\nãƒ»å¢—é¡äº‹ç”±ï¼š\n",
        child_support: "ã€é¤Šè‚²è²»ãƒ»å©šå§»è²»ç”¨ï¼ˆç®—å®šè¡¨ï¼‰ã€‘\nãƒ»ç¾©å‹™è€…å¹´åï¼šâ—‹ä¸‡å††ï¼ˆçµ¦ä¸ãƒ»è‡ªå–¶ï¼‰\nãƒ»æ¨©åˆ©è€…å¹´åï¼šâ—‹ä¸‡å††ï¼ˆçµ¦ä¸ãƒ»è‡ªå–¶ï¼‰\nãƒ»å­ã®å¹´é½¢ï¼š\nãƒ»ç®—å®šè¡¨ã®æ ï¼šâ—‹ä¸‡ã€œâ—‹ä¸‡å††\n",
        sentencing: "ã€é‡åˆ‘ç›¸å ´ãƒ»æ±‚åˆ‘äºˆæƒ³ã€‘\nãƒ»æ³•å®šåˆ‘ï¼š\nãƒ»é¡ä¼¼äº‹æ¡ˆã®é‡åˆ‘ï¼š\nãƒ»åŸ·è¡ŒçŒ¶äºˆã®è¦‹è¾¼ã¿ï¼š\n",
        notice: "ã€å¯¾å¿œæ–¹é‡ã€‘å†…å®¹è¨¼æ˜éƒµä¾¿ã®é€ä»˜\nãƒ»é€ä»˜æœŸé™ï¼š\nãƒ»é€šçŸ¥æ›¸ã®ä¸»æ—¨ï¼šå¥‘ç´„è§£é™¤ãƒ»æ”¯æ‰•å‚¬å‘Š\nãƒ»å›ç­”æœŸé™ã®è¨­å®šï¼šæœ¬æ›¸é¢åˆ°é”å¾Œâ—‹æ—¥ä»¥å†…\nãƒ»ç™ºé€å¾Œã®äºˆå®šï¼šå›ç­”ãŒãªã‘ã‚Œã°è¨´è¨Ÿæº–å‚™\n",
        negotiation: "ã€å¯¾å¿œæ–¹é‡ã€‘äº¤æ¸‰ãƒ»ç¤ºè«‡ææ¡ˆ\nãƒ»æç¤ºæ¡ä»¶ï¼š\nãƒ»è­²æ­©å¯èƒ½ãªãƒ©ã‚¤ãƒ³ï¼ˆãƒœãƒˆãƒ ãƒ©ã‚¤ãƒ³ï¼‰ï¼š\nãƒ»è§£æ±ºé‡‘ã®ç›®å®‰ï¼š\nãƒ»åˆæ„æ›¸æ¡ˆã®ä½œæˆè¦å¦ï¼š\n",
        notary: "ã€å¯¾å¿œæ–¹é‡ã€‘å…¬æ­£è¨¼æ›¸ã®ä½œæˆ\nãƒ»ç›®çš„ï¼šåŸ·è¡ŒåŠ›ã®ä»˜ä¸\nãƒ»å…¬è¨¼å½¹å ´ï¼š\nãƒ»ä½œæˆäºˆå®šæ—¥ï¼š\nãƒ»å¿…è¦æ›¸é¡ï¼šå°é‘‘è¨¼æ˜æ›¸ãƒ»æˆ¸ç±è¬„æœ¬ãªã©\n",
        mediation: "ã€å¯¾å¿œæ–¹é‡ã€‘èª¿åœãƒ»ADRç”³ç«‹ã¦\nãƒ»ç”³ç«‹å…ˆï¼šâ—‹ç°¡æ˜“è£åˆ¤æ‰€ãƒ»å¼è­·å£«ä¼šADR\nãƒ»ç”³ç«‹ã¦ã®è¶£æ—¨ï¼š\nãƒ»æƒ³å®šã•ã‚Œã‚‹æœŸé–“ï¼š\n",
        litigation: "ã€å¯¾å¿œæ–¹é‡ã€‘è¨´è¨Ÿæèµ·\nãƒ»ç®¡è½„è£åˆ¤æ‰€ï¼š\nãƒ»è¨´é¡ï¼š\nãƒ»å°ç´™ä»£äºˆç´éƒµåˆ¸ï¼š\nãƒ»ä»®å·®æŠ¼ãˆã®å¿…è¦æ€§ï¼š\n",
        dunning: "ã€å¯¾å¿œæ–¹é‡ã€‘æ”¯æ‰•ç£ä¿ƒç”³ç«‹ã¦\nãƒ»ç®¡è½„ï¼šç°¡æ˜“è£åˆ¤æ‰€æ›¸è¨˜å®˜\nãƒ»ãƒ¡ãƒªãƒƒãƒˆï¼šå®‰ä¾¡ãƒ»è¿…é€Ÿ\nãƒ»ç•°è­°ç”³ç«‹ã®ãƒªã‚¹ã‚¯ï¼š\n",
        provisional: "ã€å¯¾å¿œæ–¹é‡ã€‘ä¿å…¨å‡¦åˆ†ï¼ˆä»®å·®æŠ¼ãƒ»ä»®å‡¦åˆ†ï¼‰\nãƒ»è¢«ä¿å…¨æ¨©åˆ©ï¼š\nãƒ»ä¿å…¨ã®å¿…è¦æ€§ï¼š\nãƒ»æ‹…ä¿é‡‘ã®ç”¨æ„ï¼š\n",
        settlement: "ã€å¯¾å¿œæ–¹é‡ã€‘å³æ±ºå’Œè§£ï¼ˆèµ·è¨´å‰ã®å’Œè§£ï¼‰\nãƒ»ç®¡è½„ï¼šç°¡æ˜“è£åˆ¤æ‰€\nãƒ»åˆæ„å†…å®¹ã®æ¦‚è¦ï¼š\nãƒ»ç”³ç«‹äºˆå®šæ—¥ï¼š\n",
        complaint: "ã€å¯¾å¿œæ–¹é‡ã€‘åˆ‘äº‹å‘Šè¨´ãƒ»å‘Šç™º\nãƒ»æå‡ºå…ˆï¼šâ—‹è­¦å¯Ÿç½²ãƒ»æ¤œå¯Ÿåº\nãƒ»ç½ªåï¼š\nãƒ»è¨¼æ‹ ã®çŠ¶æ³ï¼š\nãƒ»å—ç†ã®è¦‹è¾¼ã¿ï¼š\n",
        decline: "ã€å¯¾å¿œæ–¹é‡ã€‘å—ä»»è¦‹é€ã‚Šãƒ»ç¶™ç¶šç›¸è«‡\nãƒ»ç†ç”±ï¼šå‹è¨´è¦‹è¾¼ã¿è–„ãƒ»è²»ç”¨å¯¾åŠ¹æœãƒ»åˆ©ç›Šç›¸å\nãƒ»ä¾é ¼è€…ã¸ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼š\nãƒ»æ³•ãƒ†ãƒ©ã‚¹ã®æ¡ˆå†…ï¼š\n"
    };

    // --- State & Storage ---
    const STORAGE_KEY = 'lawyer_compass_ultimate';
    
    // --- Char Count ---
    function updateCharCount(id) {
        const el = document.getElementById(id);
        const count = el.value.length;
        document.getElementById(id + '-count').innerText = count + 'æ–‡å­—';
    }

    // --- Backup & Restore ---
    function exportData() {
        // Collect current state
        const data = {
            inputs: {},
            todos: [],
            conflictDb: document.getElementById('conflictDatabase').value,
            theme: document.body.classList.contains('dark-mode') ? 'dark' : 'light'
        };
        
        document.querySelectorAll('.save-target').forEach(el => { data.inputs[el.id] = el.value; });
        document.querySelectorAll('.todo-item').forEach(item => {
            data.todos.push({
                text: item.querySelector('.todo-text').innerText,
                date: item.querySelector('.todo-date').dataset.date || '',
                priority: item.querySelector('.todo-priority').innerText,
                checked: item.querySelector('input[type="checkbox"]').checked
            });
        });

        const json = JSON.stringify(data, null, 2);
        const blob = new Blob([json], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        const timestamp = new Date().toISOString().slice(0,10).replace(/-/g,'');
        a.download = `lawyer_compass_backup_${timestamp}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }

    function importData(input) {
        const file = input.files[0];
        if(!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                // Restore inputs
                if(data.inputs) {
                    for(let id in data.inputs) {
                        const el = document.getElementById(id);
                        if(el) el.value = data.inputs[id];
                    }
                }
                // Restore DB
                if(data.conflictDb) document.getElementById('conflictDatabase').value = data.conflictDb;
                
                // Restore Todos
                const list = document.getElementById('todoList');
                list.innerHTML = '';
                if(data.todos) {
                    data.todos.forEach(t => addTodoItem(t.text, t.date, t.priority, t.checked));
                }
                // Theme
                if(data.theme) setTheme(data.theme);
                
                saveData(); // Save to local storage
                checkConflict();
                // Update counts
                updateCharCount('facts'); updateCharCount('issues'); updateCharCount('strategy');
                
                alert('ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸã€‚');
            } catch(err) {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        };
        reader.readAsText(file);
        input.value = ''; // Reset
    }

    // --- Template Insertion ---
    function insertTemplate(targetId, templateKey) {
        if (!templateKey || !TEMPLATES[templateKey]) return;
        const textarea = document.getElementById(targetId);
        const templateText = TEMPLATES[templateKey];
        const startPos = textarea.selectionStart;
        const endPos = textarea.selectionEnd;
        const val = textarea.value;
        textarea.value = val.substring(0, startPos) + templateText + val.substring(endPos, val.length);
        textarea.selectionStart = textarea.selectionEnd = startPos + templateText.length;
        textarea.focus();
        updateCharCount(targetId);
        saveData();
    }

    // --- UI/Modal Logic ---
    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) {
        document.getElementById(id).style.display = 'none';
        if(id === 'settingsModal') {
            saveData();
            checkConflict();
        }
    }
    function setTheme(mode) {
        if (mode === 'dark') {
            document.body.classList.add('dark-mode');
            document.getElementById('themeDark').classList.add('active');
            document.getElementById('themeLight').classList.remove('active');
        } else {
            document.body.classList.remove('dark-mode');
            document.getElementById('themeLight').classList.add('active');
            document.getElementById('themeDark').classList.remove('active');
        }
        saveData();
    }

    // --- Core Logic ---
    function updateConflictColor(select) {
        select.className = 'save-target';
        if (select.value === 'OK') select.classList.add('status-ok');
        if (select.value === 'è¦æ³¨æ„') select.classList.add('status-warn');
    }

    function checkConflict() {
        const inputName = document.getElementById('opponentName').value.trim();
        const alertBox = document.getElementById('conflictAlert');
        const inputGroup = document.getElementById('opponentGroup');
        const dbText = document.getElementById('conflictDatabase').value;
        
        if (!inputName) {
            alertBox.style.display = 'none';
            inputGroup.classList.remove('conflict-detected');
            return;
        }
        const blackList = dbText.split(/[\n,]+/).map(s => s.trim()).filter(s => s);
        const isConflict = blackList.some(bn => inputName.includes(bn) || bn.includes(inputName));
        
        if (isConflict) {
            alertBox.style.display = 'block';
            inputGroup.classList.add('conflict-detected');
        } else {
            alertBox.style.display = 'none';
            inputGroup.classList.remove('conflict-detected');
        }
    }

    function openCalendarSearch() {
        const name = document.getElementById('opponentName').value.trim();
        if(!name) { alert("æ¤œç´¢ã™ã‚‹ç›¸æ‰‹æ–¹åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
        const url = `https://calendar.google.com/calendar/r/search?q=${encodeURIComponent(name)}`;
        window.open(url, '_blank');
    }

    // --- ToDo Logic ---
    const todoListElement = document.getElementById('todoList');
    function setQuickTodo(text) {
        const input = document.getElementById('newTodoText');
        input.value = text;
        input.focus();
    }
    
    function addTodoItem(text, date, priority, isChecked = false) {
        const li = document.createElement('li');
        li.className = 'todo-item';
        let priorityClass = 'priority-mid';
        if(priority === 'é«˜') priorityClass = 'priority-high';
        if(priority === 'ä½') priorityClass = 'priority-low';
        
        const dateDisplay = date ? date : 'æœªå®š';
        const caseName = document.getElementById('caseName').value || '';
        const title = (caseName ? `ã€${caseName}ã€‘` : '') + text;
        
        let datesParam = "";
        if(date) {
            const d = new Date(date);
            const y = d.getFullYear();
            const m = ('0' + (d.getMonth() + 1)).slice(-2);
            const day = ('0' + d.getDate()).slice(-2);
            const start = y + m + day;
            const nextD = new Date(d); nextD.setDate(nextD.getDate() + 1);
            const end = nextD.toISOString().slice(0,10).replace(/-/g,'');
            datesParam = `&dates=${start}/${end}`;
        }
        const details = `å„ªå…ˆåº¦: ${priority}`;
        const url = `https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&details=${encodeURIComponent(details)}${datesParam}`;

        li.innerHTML = `
            <input type="checkbox" ${isChecked ? 'checked' : ''} onchange="saveData()">
            <span class="${priorityClass} priority-tag" style="font-size:0.8rem; border:1px solid currentColor; padding:1px 4px; border-radius:3px;">${priority}</span>
            <div style="flex:1">
                <div class="todo-text" style="font-weight:500;">${text}</div>
                <div class="todo-date" data-date="${date}" style="font-size:0.8rem; color:#888;">æœŸé™: ${dateDisplay}</div>
            </div>
            <a href="${url}" target="_blank" class="btn-calendar" title="Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ç™»éŒ²">ğŸ“…</a>
            <button class="btn btn-outline btn-sm" onclick="this.parentElement.remove(); saveData();" style="padding:2px 6px;">Ã—</button>
        `;
        todoListElement.appendChild(li);
        saveData();
    }

    function addTodo() {
        const text = document.getElementById('newTodoText').value;
        const date = document.getElementById('newTodoDate').value;
        const priority = document.getElementById('newTodoPriority').value;
        if(!text) return;
        addTodoItem(text, date, priority);
        document.getElementById('newTodoText').value = '';
    }

    // --- Speech ---
    let recognition = null;
    function toggleSpeech(targetId, btnElement) {
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
            alert("ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°å…¥åŠ›ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚"); return;
        }
        if (recognition) { recognition.stop(); return; }
        
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.lang = 'ja-JP';
        
        recognition.onstart = function() { btnElement.classList.add('recording-active'); };
        recognition.onend = function() { btnElement.classList.remove('recording-active'); recognition = null; saveData(); updateCharCount(targetId); };
        
        recognition.onresult = function(event) {
            const res = event.results[0][0].transcript;
            const el = document.getElementById(targetId);
            if(el.tagName === 'INPUT') el.value += (el.value ? ' ' : '') + res;
            else el.value += (el.value ? '\n' : '') + res;
        };
        recognition.start();
    }

    // --- Save & Load ---
    function saveData() {
        const data = {
            inputs: {},
            todos: [],
            theme: document.body.classList.contains('dark-mode') ? 'dark' : 'light'
        };
        document.querySelectorAll('.save-target').forEach(el => data.inputs[el.id] = el.value);
        document.querySelectorAll('.todo-item').forEach(item => {
            data.todos.push({
                text: item.querySelector('.todo-text').innerText,
                date: item.querySelector('.todo-date').dataset.date,
                priority: item.querySelector('.priority-tag').innerText,
                checked: item.querySelector('input[type="checkbox"]').checked
            });
        });
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function loadData() {
        const json = localStorage.getItem(STORAGE_KEY);
        if(!json) return;
        try {
            const data = JSON.parse(json);
            if(data.inputs) {
                for(let id in data.inputs) {
                    const el = document.getElementById(id);
                    if(el) el.value = data.inputs[id];
                }
            }
            if(data.todos) {
                const list = document.getElementById('todoList');
                list.innerHTML = '';
                data.todos.forEach(t => addTodoItem(t.text, t.date, t.priority, t.checked));
            }
            if(data.theme) setTheme(data.theme);
            
            // Post-load updates
            checkConflict();
            if(data.inputs) {
                if(data.inputs.conflictCheck) updateConflictColor(document.getElementById('conflictCheck'));
                updateCharCount('facts'); updateCharCount('issues'); updateCharCount('strategy');
            }
        } catch(e) { console.error(e); }
    }

    // --- Demo & Clear ---
    function fillDemoData() {
        if(!confirm('ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•å…¥åŠ›ã—ã¾ã™ã‹ï¼Ÿ')) return;
        document.getElementById('caseName').value = 'éˆ´æœ¨ä¸€éƒ è²¸é‡‘è¿”é‚„è«‹æ±‚äº‹ä»¶';
        document.getElementById('clientName').value = 'éˆ´æœ¨ ä¸€éƒ';
        document.getElementById('opponentName').value = 'ä½è—¤ æ¬¡éƒ';
        document.getElementById('field').value = 'å‚µæ¨©å›å';
        document.getElementById('status').value = 'ç›¸è«‡ä¸­';
        document.getElementById('conflictCheck').value = 'OK';
        document.getElementById('deadline').value = new Date().toISOString().slice(0,10);
        document.getElementById('facts').value = 'ãƒ»2023å¹´5æœˆ1æ—¥ã€çŸ¥äººã§ã‚ã‚‹ç›¸æ‰‹æ–¹ã«ç¾é‡‘300ä¸‡å††ã‚’è²¸ã—ä»˜ã‘ãŸã€‚\nãƒ»å€Ÿç”¨æ›¸ã‚ã‚Šã€‚';
        document.getElementById('issues').value = 'ãƒ»æ¶ˆæ»…æ™‚åŠ¹ã®ç¢ºèª\nãƒ»ç›¸æ‰‹æ–¹ã®è³‡åŠ›';
        document.getElementById('strategy').value = 'ãƒ»å†…å®¹è¨¼æ˜éƒµä¾¿ã«ã¦å‚¬å‘Š';
        document.getElementById('feeStart').value = '8.8%';
        document.getElementById('feeSuccess').value = '17.6%';
        document.getElementById('lawyerOffice').value = 'ä¸¸ã®å†…ç·åˆæ³•å¾‹äº‹å‹™æ‰€';
        document.getElementById('lawyerName').value = 'å¼è­·å£« æ³•å‹™ å¤ªéƒ';
        document.getElementById('conflictDatabase').value = "ä½è—¤æ¬¡éƒ\næ‚ªå¾³å•†äº‹";
        
        saveData();
        loadData(); // Re-render to update UI
    }

    function clearData() {
        if(!confirm('å…¥åŠ›å†…å®¹ã‚’æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ')) return;
        document.querySelectorAll('.save-target').forEach(el => {
            if(el.id !== 'conflictDatabase' && el.id !== 'lawyerOffice' && el.id !== 'lawyerName' && el.id !== 'googleAccount') {
                el.value = '';
            }
        });
        document.getElementById('todoList').innerHTML = '';
        saveData();
        loadData();
    }

    // --- Output ---
    function generateOutput(type) {
        const d = {
            caseName: document.getElementById('caseName').value,
            client: document.getElementById('clientName').value,
            opponent: document.getElementById('opponentName').value,
            field: document.getElementById('field').value,
            status: document.getElementById('status').value,
            deadline: document.getElementById('deadline').value,
            conflict: document.getElementById('conflictCheck').value,
            facts: document.getElementById('facts').value,
            issues: document.getElementById('issues').value,
            strategy: document.getElementById('strategy').value,
            fees: {
                time: document.getElementById('feeTimeCharge').value,
                start: document.getElementById('feeStart').value,
                success: document.getElementById('feeSuccess').value,
                spot: document.getElementById('feeSpot').value,
                rem: document.getElementById('feeRemarks').value
            },
            lawyer: { office: document.getElementById('lawyerOffice').value, name: document.getElementById('lawyerName').value },
            todos: []
        };
        
        document.querySelectorAll('.todo-item').forEach(item => {
            const text = item.querySelector('.todo-text').innerText;
            const checked = item.querySelector('input[type="checkbox"]').checked ? 'â– ' : 'â–¡';
            d.todos.push(`${checked} ${text}`);
        });

        let output = "";
        const sign = `\n--------------------------------------------------\n${d.lawyer.office}\n${d.lawyer.name}`;
        
        if (type === 'internal') {
            output = `ã€æ¡ˆä»¶ç®¡ç†ã€‘${d.caseName}\nå½“äº‹è€…ï¼š${d.client} vs ${d.opponent}\næœŸé™ï¼š${d.deadline} / ç›¸åï¼š${d.conflict}\n\nâ– äº‹å®Ÿ\n${d.facts}\n\nâ– è«–ç‚¹\n${d.issues}\n\nâ– æ–¹é‡\n${d.strategy}\n\nâ– è²»ç”¨\nç€æ‰‹é‡‘:${d.fees.start} / å ±é…¬:${d.fees.success}\nå‚™è€ƒ:${d.fees.rem}\n\nâ– ToDo\n${d.todos.join('\n')}`;
        } else if (type === 'client') {
            output = `ã€ç›¸è«‡ãƒ¡ãƒ¢ã€‘${d.caseName}\n${d.client} æ§˜\n\næœ¬æ—¥ã¯ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚\n\nâ– æ¦‚è¦\n${d.facts}\n\nâ– æ–¹é‡\n${d.strategy}\n\nâ– è²»ç”¨ç›®å®‰\nç€æ‰‹é‡‘:${d.fees.start}\nå ±é…¬é‡‘:${d.fees.success}\n${d.fees.rem}\n\n${sign}`;
        } else {
            output = `ã€å¾¡è¦‹ç©ã€‘${d.caseName}\n\nç€æ‰‹é‡‘ï¼š${d.fees.start}\nå ±é…¬é‡‘ï¼š${d.fees.success}\næ‰‹æ•°æ–™ï¼š${d.fees.spot}\n\n${d.fees.rem}\n${sign}`;
        }
        
        document.getElementById('outputText').value = output;
        document.getElementById('outputModal').style.display = 'flex';
    }

    function copyToClipboard() {
        const copyText = document.getElementById("outputText");
        copyText.select();
        document.execCommand("copy");
        alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
    }

    // --- Init ---
    document.addEventListener('DOMContentLoaded', () => {
        loadData();
    });
</script>

</body>
</html>